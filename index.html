<!DOCTYPE HTML><html><head><meta charset="utf-8"><title>DZ&#39;s Gensokyo | Best Time, Best You and Me</title><meta name="author" content="Derek Zhou"><meta name="description" content="life are flashes and here is my life"><meta id="viewport" name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta property="og:site_name" content="DZ&#39;s Gensokyo"><meta property="og:image" content="/favicon.ico"><link href="/favicon.ico" rel="icon"><link rel="alternate" href="/atom.xml" title="DZ&#39;s Gensokyo" type="application/atom+xml"><link rel="stylesheet" href="/css/style.css" media="screen" type="text/css"></head><body><div class="blog"><div class="content"><header><div class="site-branding"><h1 class="site-title"><a href="/">DZ&#39;s Gensokyo</a></h1><p class="site-description">Best Time, Best You and Me</p></div><nav class="site-navigation"><ul><li><a href="/">主页</a></li><li><a href="/archives">归档</a></li><li><a href="/tags">标签</a></li><li><a href="/about">关于</a></li></ul></nav></header><main class="site-main posts-loop"><article><h3 class="article-title"><a href="/posts/835c8e5b/"><span>web crawler share</span></a></h3><div class="article-top-meta"><span class="posted-on"><a href="/posts/835c8e5b/" rel="bookmark"><time class="entry-date published" datetime="2018-06-07T06:25:23.000Z">2018-06-07</time></a></span></div><div class="article-content"><div class="entry"><h3 id="爬虫-pandora分享"><a href="#爬虫-pandora分享" class="headerlink" title="爬虫+pandora分享"></a>爬虫+pandora分享</h3><h4 id="spider"><a href="#spider" class="headerlink" title="spider"></a>spider</h4><ul><li>搜索引擎使用网络爬虫爬取网站信息，用于建立索引供用户搜索<br><a href="https://www.google.com/search/howsearchworks/crawling-indexing/" target="_blank" rel="noopener">google</a></li><li>robots.txt <a href="https://www.google.com/webmasters/tools/robots-testing-tool?hl=zh-CN&amp;siteUrl=http://www.derekz.cn/" target="_blank" rel="noopener">google</a><br><img src="https://i.loli.net/2018/06/03/5b13aa65a3d27.png" alt="5b13aa65a3d27.png"></li><li>爬取页面/接口，提取有效信息</li></ul><h4 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h4><ul><li>快递业务<ul><li>各大快递网点信息 <a href="http://www.yundaex.com/ydweb/fuwuwangdian_search.php" target="_blank" rel="noopener">yunda</a></li></ul></li><li>饿了么、美团外卖商家<ul><li>商家信息及配送相关信息</li></ul></li></ul><h4 id="动手"><a href="#动手" class="headerlink" title="动手"></a>动手</h4><ul><li><p>node-crawler <a href="https://github.com/bda-research/node-crawler" target="_blank" rel="noopener">github</a></p><ul><li><p>访问页面，处理返回，提取数据</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 列表爬虫</span></span><br><span class="line"><span class="keyword">const</span> spider = <span class="keyword">new</span> Carwler(&#123;</span><br><span class="line">  callback(err, res, done) &#123;</span><br><span class="line">    <span class="comment">// do sth</span></span><br><span class="line">    <span class="keyword">const</span> detailQueue = []</span><br><span class="line">    detailSpider.queue(detailQueue)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 详情爬虫</span></span><br><span class="line"><span class="keyword">const</span> detailSpider = <span class="keyword">new</span> Crawler()</span><br><span class="line"><span class="comment">// 开始</span></span><br><span class="line"><span class="keyword">const</span> run = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> listQueue = []</span><br><span class="line">  <span class="comment">// 需要爬取的内容队列</span></span><br><span class="line">  spider.queue(listQueue)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>cheerio</p><blockquote><p>去除了浏览器端相关部分的jQuery，能够解析标签，在server端对html进行一些和客户端jQuery一样的操作</p></blockquote><p><img src="https://i.loli.net/2018/06/03/5b13ae956b210.png" alt="5b13ae956b210.png"></p></li></ul></li><li><p>puppeteer</p><ul><li>谷歌出品，必属精品</li><li><p>打开一个headless chrome，模拟访问，页面执行</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> start() &#123;</span><br><span class="line">  <span class="comment">// launch browser</span></span><br><span class="line">  <span class="keyword">this</span>.browser = <span class="keyword">await</span> puppeteer.launch();</span><br><span class="line">  <span class="keyword">this</span>.logger.info(<span class="string">"Service puppeteerService Started"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> take(url) &#123;</span><br><span class="line">  <span class="comment">// create page</span></span><br><span class="line">  <span class="keyword">const</span> page = <span class="keyword">await</span> <span class="keyword">this</span>.browser.newPage();</span><br><span class="line">  page.setViewport(&#123; <span class="attr">width</span>: <span class="number">1920</span>, <span class="attr">height</span>: <span class="number">1080</span> &#125;);</span><br><span class="line">  <span class="keyword">await</span> page.goto(url);</span><br><span class="line">  <span class="comment">// screenshot</span></span><br><span class="line">  <span class="keyword">const</span> buf = <span class="keyword">await</span> page.screenshot(&#123; <span class="attr">type</span>: <span class="string">"jpeg"</span>, <span class="attr">quality</span>: <span class="number">60</span> &#125;);</span><br><span class="line">  <span class="keyword">await</span> page.close();</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// 现在 IPC Hub 不能直接传递 Buffer，需要 base64。</span></span><br><span class="line">    list: buf.toString(<span class="string">"base64"</span>)</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><a href="http://csbun.github.io/blog/2017/09/puppeteer/" target="_blank" rel="noopener">example article</a></li><li><a href="https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md" target="_blank" rel="noopener">api doc</a></li></ul></li></ul></li></ul><h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><ul><li>饿了么商家<ul><li>区域覆盖<br><img src="https://i.loli.net/2018/06/03/5b13b6ef82642.png" alt="5b13b6ef82642.png"></li><li>代理<ul><li>重试，加日志</li><li>代理动态替换</li></ul></li></ul></li></ul><h4 id="more"><a href="#more" class="headerlink" title="more"></a>more</h4><ul><li>pandora<ul><li>service</li></ul></li></ul></div></div><div class="article-footer"><div class="article-meta pull-left"><span class="post-categories"><i class="icon-categories"></i> <a href="/categories/code/">code</a> </span><span class="post-tags"><i class="icon-tags"></i> <a href="/tags/crawler/">crawler</a></span></div></div></article><article><h3 class="article-title"><a href="/posts/52924cd5/"><span>计网基础 持续更新ing</span></a></h3><div class="article-top-meta"><span class="posted-on"><a href="/posts/52924cd5/" rel="bookmark"><time class="entry-date published" datetime="2018-01-25T07:40:00.000Z">2018-01-25</time></a></span></div><div class="article-content"><div class="entry"><p>&emsp;&emsp;年底了，无心写代码，回头看看一些基础知识，持续更新中…<br></p></div></div><div class="article-footer"><div class="article-meta pull-left"><span class="post-categories"><i class="icon-categories"></i> <a href="/categories/code/">code</a> </span><span class="post-tags"><i class="icon-tags"></i> <a href="/tags/计算机网络/">计算机网络</a></span></div></div></article><article><h3 class="article-title"><a href="/posts/f0693436/"><span>dz-pj 在线音乐SPA</span></a></h3><div class="article-top-meta"><span class="posted-on"><a href="/posts/f0693436/" rel="bookmark"><time class="entry-date published" datetime="2018-01-19T05:04:54.000Z">2018-01-19</time></a></span></div><div class="article-content"><div class="entry"><p>&emsp;&emsp;一时兴起，写了个简单的音乐站，满足自己平时听歌的需要。欢迎朋友们试用、提<a href="https://github.com/derekeeeeely/dz-music/issues" target="_blank" rel="noopener">issue</a>、<a href="https://github.com/derekeeeeely/dz-music" target="_blank" rel="noopener">star</a>~<br></p></div></div><div class="article-footer"><div class="article-meta pull-left"><span class="post-categories"><i class="icon-categories"></i> <a href="/categories/projects/">projects</a> </span><span class="post-tags"><i class="icon-tags"></i> <a href="/tags/react/">react</a></span></div></div></article><article><h3 class="article-title"><a href="/posts/5f9de541/"><span>node-v8 Isolate和GC</span></a></h3><div class="article-top-meta"><span class="posted-on"><a href="/posts/5f9de541/" rel="bookmark"><time class="entry-date published" datetime="2018-01-06T07:51:30.000Z">2018-01-06</time></a></span></div><div class="article-content"><div class="entry"><p>&emsp;&emsp;Node/V8学习笔记系列1，关于Isolate（V8实例）和GC（垃圾回收机制）。</p></div></div><div class="article-footer"><div class="article-meta pull-left"><span class="post-categories"><i class="icon-categories"></i> <a href="/categories/code/">code</a> </span><span class="post-tags"><i class="icon-tags"></i> <a href="/tags/node/">node</a><a href="/tags/v8/">v8</a></span></div></div></article><article><h3 class="article-title"><a href="/posts/8b1fc7d6/"><span>dz&#39;s 你好2018</span></a></h3><div class="article-top-meta"><span class="posted-on"><a href="/posts/8b1fc7d6/" rel="bookmark"><time class="entry-date published" datetime="2018-01-03T17:52:57.000Z">2018-01-04</time></a></span></div><div class="article-content"><div class="entry"><p>&emsp;&emsp;可能很难实现但还是怀着希望认认真真写下来的新年计划。<br></p></div></div><div class="article-footer"><div class="article-meta pull-left"><span class="post-categories"><i class="icon-categories"></i> <a href="/categories/life/">life</a> </span><span class="post-tags"><i class="icon-tags"></i> <a href="/tags/thinking/">thinking</a></span></div></div></article><article><h3 class="article-title"><a href="/posts/815e4034/"><span>dz&#39;s 2017那些事</span></a></h3><div class="article-top-meta"><span class="posted-on"><a href="/posts/815e4034/" rel="bookmark"><time class="entry-date published" datetime="2018-01-01T13:03:40.000Z">2018-01-01</time></a></span></div><div class="article-content"><div class="entry"><p>&emsp;&emsp;这是一篇正经的需要上交的年度总结。<br></p></div></div><div class="article-footer"><div class="article-meta pull-left"><span class="post-categories"><i class="icon-categories"></i> <a href="/categories/life/">life</a> </span><span class="post-tags"><i class="icon-tags"></i> <a href="/tags/thinking/">thinking</a></span></div></div></article><article><h3 class="article-title"><a href="/posts/c4697232/"><span>mvx 从todo mvc说起</span></a></h3><div class="article-top-meta"><span class="posted-on"><a href="/posts/c4697232/" rel="bookmark"><time class="entry-date published" datetime="2017-12-18T08:17:17.000Z">2017-12-18</time></a></span></div><div class="article-content"><div class="entry"><p>&emsp;&emsp;在git上看到一个<a href="https://github.com/tastejs/todomvc" target="_blank" rel="noopener">to do mvc</a>的repo，一时有了兴致，记录下一些点。<br></p></div></div><div class="article-footer"><div class="article-meta pull-left"><span class="post-categories"><i class="icon-categories"></i> <a href="/categories/code/">code</a> </span><span class="post-tags"><i class="icon-tags"></i> <a href="/tags/mvx/">mvx</a></span></div></div></article><article><h3 class="article-title"><a href="/posts/2082e7b0/"><span>dz-life 摄影小笔记</span></a></h3><div class="article-top-meta"><span class="posted-on"><a href="/posts/2082e7b0/" rel="bookmark"><time class="entry-date published" datetime="2017-12-13T17:34:59.000Z">2017-12-14</time></a></span></div><div class="article-content"><div class="entry"><p>&emsp;&emsp;我能想到最浪漫的事…之一，就是用镜头记录下你最美的瞬间。<br></p></div></div><div class="article-footer"><div class="article-meta pull-left"><span class="post-categories"><i class="icon-categories"></i> <a href="/categories/life/">life</a> </span><span class="post-tags"><i class="icon-tags"></i> <a href="/tags/摄影/">摄影</a></span></div></div></article><article><h3 class="article-title"><a href="/posts/c48da636/"><span>dubbo-rpc 初探rpc</span></a></h3><div class="article-top-meta"><span class="posted-on"><a href="/posts/c48da636/" rel="bookmark"><time class="entry-date published" datetime="2017-11-21T14:08:50.000Z">2017-11-21</time></a></span></div><div class="article-content"><div class="entry"><p>&emsp;&emsp;抱着学习理解dubbo的心思，从各方大佬身上取经，记下学习笔记，方便自己，服务志同道合的小伙伴们。<br></p></div></div><div class="article-footer"><div class="article-meta pull-left"><span class="post-categories"><i class="icon-categories"></i> <a href="/categories/code/">code</a> </span><span class="post-tags"><i class="icon-tags"></i> <a href="/tags/rpc/">rpc</a><a href="/tags/dubbo/">dubbo</a></span></div></div></article><article><h3 class="article-title"><a href="/posts/7819203f/"><span>js-es6 异步篇</span></a></h3><div class="article-top-meta"><span class="posted-on"><a href="/posts/7819203f/" rel="bookmark"><time class="entry-date published" datetime="2017-11-07T05:41:34.000Z">2017-11-07</time></a></span></div><div class="article-content"><div class="entry"><p>&emsp;&emsp;承上一篇，本文记录了es6的Promise对象、Generator函数和async await语法糖，异步真是让人又爱又恨。<br></p></div></div><div class="article-footer"><div class="article-meta pull-left"><span class="post-categories"><i class="icon-categories"></i> <a href="/categories/code/">code</a> </span><span class="post-tags"><i class="icon-tags"></i> <a href="/tags/js/">js</a></span></div></div></article><nav class="pagination"><a href="/page/2/" class="pagination-next">下一页</a></nav></main><footer class="site-footer"><p class="site-info">Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a><br>&copy; 2018 Derek Zhou</p></footer></div></div></body></html>