<!DOCTYPE HTML><html><head><meta charset="utf-8"><title>js-es6 å¼‚æ­¥ç¯‡ | DZ&#39;s Gensokyo | Best Time, Best You and Me</title><meta name="author" content="Derek Zhou"><meta name="description" content="life are flashes and here is my life"><meta name="keywords" content="js"><meta id="viewport" name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta property="og:title" content="js-es6 å¼‚æ­¥ç¯‡"><meta property="og:site_name" content="DZ&#39;s Gensokyo"><meta property="og:image" content="/favicon.ico"><link href="/favicon.ico" rel="icon"><link rel="alternate" href="/atom.xml" title="DZ&#39;s Gensokyo" type="application/atom+xml"><link rel="stylesheet" href="/css/style.css" media="screen" type="text/css"></head><body><div class="blog"><div class="content"><header><div class="site-branding"><h1 class="site-title"><a href="/">DZ&#39;s Gensokyo</a></h1><p class="site-description">Best Time, Best You and Me</p></div><nav class="site-navigation"><ul><li><a href="/">ä¸»é¡µ</a></li><li><a href="/archives">å½’æ¡£</a></li></ul></nav></header><main class="site-main posts-loop"><article><h3 class="article-title"><span>js-es6 å¼‚æ­¥ç¯‡</span></h3><div class="article-top-meta"><span class="posted-on"><a href="/posts/7819203f/" rel="bookmark"><time class="entry-date published" datetime="2017-11-07T05:41:34.000Z">2017-11-07</time></a></span></div><div class="article-content"><div class="entry"><p>&emsp;&emsp;æ‰¿ä¸Šä¸€ç¯‡ï¼Œæœ¬æ–‡è®°å½•äº†es6çš„Promiseå¯¹è±¡ã€Generatorå‡½æ•°å’Œasync awaitè¯­æ³•ç³–ï¼Œå¼‚æ­¥çœŸæ˜¯è®©äººåˆçˆ±åˆæ¨ã€‚<br><a id="more"></a></p><h2 id="lesson1-Promise"><a href="#lesson1-Promise" class="headerlink" title="lesson1 Promise"></a>lesson1 Promise</h2><h3 id="ä½ çš„åå­—"><a href="#ä½ çš„åå­—" class="headerlink" title="ä½ çš„åå­—"></a>ä½ çš„åå­—</h3><ul><li><code>Promise</code> è¯äºç¤¾åŒºï¼Œåˆä¸ºå¼‚æ­¥ç¼–ç¨‹ä¹‹è§£å†³æ–¹æ¡ˆï¼Œåæœ‰ES6å°†å…¶å†™å…¥è¯­è¨€æ ‡å‡†ï¼Œç»ˆæˆä»Šäººæ‰€è¨€ä¹‹ <code>Promise</code> å¯¹è±¡<ul><li>Promiseå¯¹è±¡ç‰¹ç‚¹æœ‰äºŒï¼šçŠ¶æ€ä¸å—å¤–ç•Œå½±å“ã€ä¸€æ—¦çŠ¶æ€æ”¹å˜åä¸ä¼šå†æ¬¡æ”¹å˜</li></ul></li></ul><h3 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h3><ul><li><p>Promiseå¯¹è±¡ä¸ºä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œç”¨äºç”ŸæˆPromiseå®ä¾‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå‡½æ•°å‚æ•°æœ‰ä¸¤ä¸ªï¼Œä¸ºjså¼•æ“å†…éƒ¨å®ç°çš„ä¸¤ä¸ªå‡½æ•°</span></span><br><span class="line"><span class="keyword">let</span> pr = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> () &#123;</span><br><span class="line">    resolve() <span class="comment">// pending -&gt; resolved</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    reject() <span class="comment">// pending -&gt; rejected</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>Promiseå®ä¾‹ç”Ÿæˆåå¯ä»¥ä½¿ç”¨thenæ–¹æ³•æŒ‡å®šä¸¤ç§çŠ¶æ€ä¸‹çš„å›è°ƒå‡½æ•°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬äºŒä¸ªå‡½æ•°å¯é€‰</span></span><br><span class="line">pr.then( <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// throw error</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>soâ€¦<br>å°è£…ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œåœ¨Promiseå®ä¾‹åˆ›å»ºæ—¶ä¼ å…¥çš„å‡½æ•°å‚æ•°å†…è¿›è¡Œé€»è¾‘å¤„ç†ï¼ˆå†³å®šä½•æ—¶æ”¹å˜çŠ¶æ€å¹¶ä¼ é€’å€¼åˆ°å›è°ƒå‡½æ•°ï¼‰<br>åˆ©ç”¨Promiseå®ä¾‹çš„thenæ–¹æ³•æ¥æ”¶ä¸Šä¸€æ­¥çš„ä¼ é€’å€¼å¤„ç†åç»­ï¼ˆresolveä¼ é€’çš„å€¼å¯ä»¥ä¸ºPromiseå¯¹è±¡ï¼Œrejectä¼ é€’çš„å€¼å¤šä¸ºErrorå¯¹è±¡ï¼‰</p><ul><li>æ³¨æ„ï¼šresolveæˆ–rejectå¹¶ä¸ä¼šç»ˆç»“ Promise çš„å‚æ•°å‡½æ•°çš„æ‰§è¡Œï¼Œå› ä¸ºç«‹å³resolveæˆ–rejectçš„Promiseæ˜¯åœ¨æœ¬æ¬¡æ—¶é—´å¾ªç¯å°¾éƒ¨ï¼Œæ™šäºæœ¬è½®çš„åŒæ­¥ä»»åŠ¡</li><li>æ³¨æ„ï¼šä¸€èˆ¬resolveæˆ–è€…rejectä¹‹åPromiseä»»åŠ¡å®Œæˆäº†ï¼Œåç»­åº”è¯¥å†™åœ¨thençš„å›è°ƒå‡½æ•°å†…ï¼Œæ‰€ä»¥å¯ä»¥è¿™æ ·<code>return resolve(value)</code></li></ul></li></ul><h3 id="æˆ‘æ„šè ¢çš„å­©å­ä»¬"><a href="#æˆ‘æ„šè ¢çš„å­©å­ä»¬" class="headerlink" title="æˆ‘æ„šè ¢çš„å­©å­ä»¬"></a>æˆ‘æ„šè ¢çš„å­©å­ä»¬</h3><h4 id="Promise-prototype-then"><a href="#Promise-prototype-then" class="headerlink" title="Promise.prototype.then"></a>Promise.prototype.then</h4><ul><li><p>å‚æ•°ï¼šä¸¤ä¸ªå‡½æ•°ï¼Œåä¸€ä¸ªå¯é€‰</p></li><li><p>è¿”å›ï¼šæ–°çš„Promiseå®ä¾‹<br>å¯ä»¥é‡‡ç”¨é“¾å¼å†™æ³•ï¼Œä¸Šä¸€ä¸ªå›è°ƒå‡½æ•°çš„è¿”å›å€¼ä¼šä½œä¸ºå‚æ•°ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªå›è°ƒå‡½æ•°å†…<br>è‹¥ä¸Šä¸€ä¸ªå›è°ƒå‡½æ•°è¿”å›çš„æ˜¯Promiseåˆ™éœ€è¦ç­‰çŠ¶æ€æ”¹å˜å†è°ƒç”¨ä¸‹ä¸€ä¸ªå›è°ƒå‡½æ•°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">getJSON(<span class="string">"/post/1.json"</span>).then(</span><br><span class="line">  <span class="comment">// è¿”å›çš„æ˜¯ä¸€ä¸ªPromiseï¼Œå…¶çŠ¶æ€æ”¹å˜åæ ¹æ®çŠ¶æ€é€‰æ‹©è°ƒç”¨ä¸‹é¢çš„thenä¸­çš„å“ªä¸ªå›è°ƒå‡½æ•°</span></span><br><span class="line">  post =&gt; getJSON(post.commentURL)</span><br><span class="line">).then(</span><br><span class="line">  comments =&gt; <span class="built_in">console</span>.log(<span class="string">"resolved: "</span>, comments),</span><br><span class="line">  err =&gt; <span class="built_in">console</span>.log(<span class="string">"rejected: "</span>, err)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li></ul><h4 id="Promise-prototype-catch"><a href="#Promise-prototype-catch" class="headerlink" title="Promise.prototype.catch"></a>Promise.prototype.catch</h4><ul><li>å®é™…ä¸Šï¼šæ˜¯<code>.then(null, rejection)</code>çš„åˆ«å</li><li>é“¾å¼å†™æ³•æœ€åä¸€ä¸ªcatchå¯ä»¥æ•è·å‰é¢ä»»ä½•ä¸€ä¸ªPromiseå¯¹è±¡thenæ–¹æ³•æŠ›å‡ºçš„error</li><li>æ¨èä½¿ç”¨catchï¼Œè€Œä¸æ˜¯ä¸¤ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°</li><li>è‹¥æ²¡æœ‰æŒ‡å®šé”™è¯¯å¤„ç†çš„å›è°ƒï¼ŒPromiseä¼šåƒæ‰é”™è¯¯ï¼Œä¸ä¼šé€€å‡ºè¿›ç¨‹ã€ç»ˆæ­¢è„šæœ¬è¿è¡Œ</li><li>catchæ–¹æ³•é‡Œè¿˜å¯ä»¥å†æŠ›é”™ï¼Œå†é“¾å¼catchâ€¦</li></ul><h4 id="Promise-all"><a href="#Promise-all" class="headerlink" title="Promise.all"></a>Promise.all</h4><ul><li>å‚æ•°ï¼š å…·æœ‰Iteratoræ¥å£</li><li><p>è¿”å›ï¼š Promiseå®ä¾‹ä»¬</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="built_in">Promise</span>.all([p1, p2, p3]);</span><br></pre></td></tr></table></figure><p>p1, p2, p3éƒ½ä¸ºfullfilledæ—¶pæ‰fullfilledï¼Œå…¶ä¸­ä¸€ä¸ªrejectedåˆ™på°±rejected<br>å¦‚æœå…¶ä¸­ä¸€ä¸ªPromiseå®ä¾‹å®šä¹‰äº†catchï¼Œé”™è¯¯ä¼šè¢«è‡ªå·±çš„catchæ•è·ç„¶åè¿”å›ä¸€ä¸ªæ–°çš„Promiseå®ä¾‹ï¼Œåœ¨æ‰§è¡Œå®Œcatchåè¯¥å®ä¾‹ä¹Ÿresolvedï¼Œæ‰€ä»¥ä¸ä¼šè¢«å¤–éƒ¨pçš„catchæ•è·åˆ°ï¼Œè‹¥æ²¡æœ‰ï¼Œå½“ç„¶ä¼šè¢«å¤–é¢æ•è·åˆ°å•¦</p></li></ul><h4 id="Promise-race"><a href="#Promise-race" class="headerlink" title="Promise.race"></a>Promise.race</h4><ul><li>æ¦‚è¿°ï¼šåŒæ ·æ˜¯å¤šä¸ªPromiseå®ä¾‹ï¼Œç¬¬ä¸€ä¸ªçŠ¶æ€æ”¹å˜çš„Promiseå®ä¾‹ä¼šä½¿å¾—pçŠ¶æ€è·Ÿç€æ”¹å˜</li><li>ç”¨å¤„ğŸŒ°ï¼šä¸€å®šæ—¶é—´å†…è·å–ä¸åˆ°å°±rejected<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="built_in">Promise</span>.race([</span><br><span class="line">  fetch(<span class="string">'/resource-that-may-take-a-while'</span>),</span><br><span class="line">  <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'request timeout'</span>)), <span class="number">5000</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">]);</span><br><span class="line">p.then(<span class="function"><span class="params">response</span> =&gt;</span> <span class="built_in">console</span>.log(response));</span><br><span class="line">p.catch(<span class="function"><span class="params">error</span> =&gt;</span> <span class="built_in">console</span>.log(error));</span><br></pre></td></tr></table></figure></li></ul><h4 id="Promise-resolve-Promise-reject"><a href="#Promise-resolve-Promise-reject" class="headerlink" title="Promise.resolve/Promise.reject"></a>Promise.resolve/Promise.reject</h4><ul><li><p>å—¯</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.resolve(<span class="string">'foo'</span>)</span><br><span class="line"><span class="comment">// ç­‰ä»·äºä¸‹é¢ï¼Œå³ç”Ÿæˆä¸€ä¸ªPromiseå®ä¾‹ï¼ŒçŠ¶æ€ä¸ºresolvedï¼Œä¸”å°†å€¼ä¼ ç»™å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> resolve(<span class="string">'foo'</span>))</span><br></pre></td></tr></table></figure></li><li><p>æƒ…å†µ</p><ul><li>å‚æ•°ä¸ºthenableå¯¹è±¡ï¼Œå³å…·æœ‰thenæ–¹æ³•çš„å¯¹è±¡ =&gt;<br>å°†å¯¹è±¡å°è£…ä¸ºPromiseå¯¹è±¡ï¼Œç«‹å³æ‰§è¡ŒåŸå¯¹è±¡çš„thenæ–¹æ³•ï¼Œç„¶ååœ¨æ ¹æ®çŠ¶æ€å˜åŒ–å»è°ƒç”¨Promise.thençš„å›è°ƒå‡½æ•°</li><li>ä¸æ˜¯thenableå¯¹è±¡æˆ–è€…ä¸æ˜¯å¯¹è±¡<br>å‚è§<code>å—¯</code></li><li>ä¸ä¼ å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªresolvedçš„Promiseå¯¹è±¡</li></ul></li><li><p>æ³¨æ„ï¼šç«‹å³resolveçš„Promiseå¯¹è±¡ï¼Œæ˜¯åœ¨æœ¬è½®â€œäº‹ä»¶å¾ªç¯â€ï¼ˆevent loopï¼‰çš„ç»“æŸæ—¶ï¼Œè€Œä¸æ˜¯åœ¨ä¸‹ä¸€è½®â€œäº‹ä»¶å¾ªç¯â€çš„å¼€å§‹æ—¶</p></li><li>æ³¨æ„ï¼šPromise.reject(res)æœ‰ä¸€ç‚¹ä¸åŒï¼Œåœ¨äºå‚æ•°resç›´æ¥ä½œä¸ºrejectedçš„ç†ç”±ï¼ŒåŸå°ä¸åŠ¨åœ°è¢«catch</li></ul><h4 id="Promise-done-Promise-finally"><a href="#Promise-done-Promise-finally" class="headerlink" title="Promise.done/Promise.finally"></a>Promise.done/Promise.finally</h4><ul><li>å‰è€…è¡¨ç¤ºæ— è®ºå¦‚ä½•éƒ½ä¼šæ¥æ”¶åˆ°å¯èƒ½çš„é”™è¯¯ï¼Œå…¨å±€æŠ›å‡ºï¼Œåè€…æ˜¯æ— è®ºå¦‚ä½•éƒ½ä¼šåœ¨æœ€åæ‰§è¡Œä¼ å…¥çš„callback<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// done</span></span><br><span class="line"><span class="built_in">Promise</span>.prototype.done = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled, onRejected</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.then(onFulfilled, onRejected)</span><br><span class="line">    .catch(<span class="function"><span class="keyword">function</span> (<span class="params">reason</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// æŠ›å‡ºä¸€ä¸ªå…¨å±€é”™è¯¯</span></span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="keyword">throw</span> reason &#125;, <span class="number">0</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// finally</span></span><br><span class="line"><span class="built_in">Promise</span>.prototype.finally = <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> P = <span class="keyword">this</span>.constructor;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.then(</span><br><span class="line">    value  =&gt; P.resolve(callback()).then(<span class="function"><span class="params">()</span> =&gt;</span> value),</span><br><span class="line">    reason =&gt; P.resolve(callback()).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="keyword">throw</span> reason &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li></ul><h4 id="Promise-try"><a href="#Promise-try" class="headerlink" title="Promise.try"></a>Promise.try</h4><ul><li>ææ¡ˆï¼šæ¨¡æ‹Ÿtryï¼Œæ˜¯å¼‚æ­¥å°±å¼‚æ­¥ï¼Œæ˜¯åŒæ­¥å°±åŒæ­¥ï¼Œå°±ææï¼Œå†è¯´</li></ul><h2 id="lesson2-Generator"><a href="#lesson2-Generator" class="headerlink" title="lesson2 Generator"></a>lesson2 Generator</h2><h3 id="åˆæ¢"><a href="#åˆæ¢" class="headerlink" title="åˆæ¢"></a>åˆæ¢</h3><h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><ul><li>ä¸€ä¸ªéå†å™¨ç”Ÿæˆå‡½æ•°ï¼Œä¸€ä¸ªçŠ¶æ€æœº</li><li>è°ƒç”¨Generatorå‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªéå†å™¨ï¼Œä»£è¡¨Generatorå‡½æ•°çš„å†…éƒ¨æŒ‡é’ˆï¼ˆæ­¤æ—¶yieldåçš„è¡¨è¾¾å¼ä¸ä¼šæ±‚å€¼ï¼‰</li><li>æ¯æ¬¡è°ƒç”¨nextæ–¹æ³•ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ªyieldå‰çš„è¯­å¥å¹¶ä¸”è¿”å›ä¸€ä¸ª{value, done}å¯¹è±¡ï¼Œå…¶ä¸­valueå±æ€§è¡¨ç¤ºå½“å‰çš„å†…éƒ¨çŠ¶æ€çš„å€¼ï¼Œæ˜¯yieldè¡¨è¾¾å¼åé¢é‚£ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼Œdoneå±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦éå†ç»“æŸ</li><li>è‹¥æ²¡æœ‰yieldäº†ï¼Œnextæ‰§è¡Œåˆ°å‡½æ•°ç»“æŸï¼Œå¹¶å°†returnç»“æœä½œä¸ºvalueè¿”å›ï¼Œè‹¥æ— returnåˆ™ä¸ºundefinedã€‚</li><li>è¿™ä¹‹åè°ƒç”¨nextå°†è¿”å›{value: undefined, done: true}</li></ul><h4 id="yield"><a href="#yield" class="headerlink" title="yield"></a>yield</h4><ul><li><p>æƒ°æ€§<br>è°ƒç”¨nextæ–¹æ³•æ—¶ï¼Œå°†yieldåçš„è¡¨è¾¾å¼çš„å€¼ä½œä¸ºvalueè¿”å›ï¼Œåªæœ‰ä¸‹æ¬¡å†è°ƒç”¨nextæ‰ä¼šæ‰§è¡Œè¿™ä¹‹åçš„è¯­å¥ï¼Œè¾¾åˆ°äº†æš‚åœæ‰§è¡Œçš„æ•ˆæœï¼Œç›¸å½“äºå…·å¤‡äº†ä¸€ä¸ªæƒ°æ€§æ±‚å€¼çš„åŠŸèƒ½</p></li><li><p>æ²¡æœ‰yieldæ—¶ï¼ŒGeneratorå‡½æ•°ä¸ºä¸€ä¸ªå•çº¯çš„æš‚ç¼“æ‰§è¡Œå‡½æ•°ï¼ˆéœ€è¦è°ƒç”¨nextæ‰§è¡Œï¼‰</p></li><li>yieldåªèƒ½ç”¨äºGeneratorå‡½æ•°</li></ul><h4 id="Iteratoræ¥å£"><a href="#Iteratoræ¥å£" class="headerlink" title="Iteratoræ¥å£"></a>Iteratoræ¥å£</h4><ul><li>Generatorå‡½æ•°ä¸ºéå†å™¨ç”Ÿæˆå‡½æ•°ï¼Œå¯ä»¥èµ‹ç»™å¯¹è±¡çš„Symbol.iteratoræ–¹æ³•ï¼Œæœ¬èº«ä¹Ÿå…·æœ‰Symbol.iteratorå±æ€§<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="comment">// some code</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> g = gen();</span><br><span class="line">g[<span class="built_in">Symbol</span>.iterator]() === g</span><br><span class="line"><span class="comment">// true</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="forâ€¦of"><a href="#forâ€¦of" class="headerlink" title="forâ€¦of"></a>forâ€¦of</h4><ul><li>Generatorå‡½æ•°è¿”å›çš„æ˜¯éå†å™¨å¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥ç”¨forâ€¦ofè®¿é—®</li><li>æ³¨æ„ï¼šdoneä¸ºtrueçš„ä¼šè¢«forâ€¦ofå¿½ç•¥</li><li>åˆ©ç”¨Generatorä¸ºå¯¹è±¡å®ç°Iteratoræ¥å£<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">objectEntries</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> propKeys = <span class="built_in">Object</span>.keys(<span class="keyword">this</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> propKey <span class="keyword">of</span> propKeys) &#123;</span><br><span class="line">    <span class="keyword">yield</span> [propKey, <span class="keyword">this</span>[propKey]];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> jane = &#123; <span class="attr">first</span>: <span class="string">'Jane'</span>, <span class="attr">last</span>: <span class="string">'Doe'</span> &#125;;</span><br><span class="line">jane[<span class="built_in">Symbol</span>.iterator] = objectEntries;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [key, value] <span class="keyword">of</span> jane) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;key&#125;</span>: <span class="subst">$&#123;value&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// first: Jane</span></span><br><span class="line"><span class="comment">// last: Doe</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h3><h4 id="Generator-prototype-next"><a href="#Generator-prototype-next" class="headerlink" title="Generator.prototype.next()"></a><code>Generator.prototype.next()</code></h4><ul><li>å‚æ•°<br>é€šè¿‡ä¼ å…¥å‚æ•°ä¸ºGeneratorå‡½æ•°å†…éƒ¨æ³¨å…¥ä¸åŒçš„å€¼æ¥è°ƒæ•´å‡½æ•°æ¥ä¸‹æ¥çš„è¡Œä¸º<br>ç¬¬ä¸€æ¬¡nextä¼ é€’çš„å‚æ•°ä¼šè¢«å¿½ç•¥ï¼ˆå®åœ¨æƒ³ä¼ å¾—åŒ…ä¸€å±‚ï¼‰<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™é‡Œåˆ©ç”¨å‚æ•°å®ç°äº†é‡ç½®</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; <span class="literal">true</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> reset = <span class="keyword">yield</span> i;</span><br><span class="line">    <span class="keyword">if</span>(reset) &#123; i = <span class="number">-1</span>; &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> g = f();</span><br><span class="line">g.next() <span class="comment">// &#123; value: 0, done: false &#125;</span></span><br><span class="line">g.next() <span class="comment">// &#123; value: 1, done: false &#125;</span></span><br><span class="line"><span class="comment">// ä¼ é€’çš„å‚æ•°ä¼šè¢«èµ‹å€¼ç»™iï¼ˆyieldåçš„è¡¨è¾¾å¼çš„å€¼(i)ï¼‰ï¼Œç„¶åæ‰§è¡Œvar reset = ièµ‹å€¼ç»™reset</span></span><br><span class="line">g.next(<span class="literal">true</span>) <span class="comment">// &#123; value: 0, done: false &#125;</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="Generator-prototype-throw"><a href="#Generator-prototype-throw" class="headerlink" title="Generator.prototype.throw()"></a><code>Generator.prototype.throw()</code></h4><ul><li>Generatorå‡½æ•°è¿”å›çš„å¯¹è±¡éƒ½å…·æœ‰throwæ–¹æ³•ï¼Œç”¨äºåœ¨å‡½æ•°ä½“å¤–æŠ›å‡ºé”™è¯¯ï¼Œåœ¨å‡½æ•°ä½“å†…å¯ä»¥æ•è·ï¼ˆåªèƒ½catchä¸€æ¬¡ï¼‰</li><li>å‚æ•°å¯ä»¥ä¸ºErrorå¯¹è±¡</li><li>å¦‚æœå‡½æ•°ä½“å†…æ²¡æœ‰éƒ¨ç½²tryâ€¦catchä»£ç å—ï¼Œé‚£ä¹ˆthrowæŠ›å‡ºçš„é”™ä¼šè¢«å¤–éƒ¨tryâ€¦catchä»£ç å—æ•è·ï¼Œå¦‚æœå¤–éƒ¨ä¹Ÿæ²¡æœ‰ï¼Œåˆ™ç¨‹åºæŠ¥é”™ï¼Œä¸­æ–­æ‰§è¡Œ</li><li>throwæ–¹æ³•è¢«å†…éƒ¨catchä»¥åé™„å¸¦æ‰§è¡Œä¸€æ¬¡next</li><li>å‡½æ•°å†…éƒ¨çš„errorå¯ä»¥è¢«å¤–éƒ¨catch</li><li>å¦‚æœGeneratoræ‰§è¡Œè¿‡ç¨‹ä¸­å†…éƒ¨æŠ›é”™ï¼Œä¸”æ²¡è¢«å†…éƒ¨catchï¼Œåˆ™ä¸ä¼šå†æ‰§è¡Œä¸‹å»äº†ï¼Œä¸‹æ¬¡è°ƒç”¨nextä¼šè§†ä¸ºè¯¥Generatorå·²è¿è¡Œç»“æŸ</li><li>Generatorå‡½æ•°è¿”å›çš„å¯¹è±¡åœ¨è¢«nextè®¿é—®å®Œåå†…éƒ¨å±æ€§<code>[[GeneratorStatus]]</code>å€¼å˜ä¸ºâ€™closedâ€™äº†</li></ul><h4 id="Generator-prototype-return"><a href="#Generator-prototype-return" class="headerlink" title="Generator.prototype.return()"></a><code>Generator.prototype.return()</code></h4><ul><li><code>try ... finally</code>å­˜åœ¨æ—¶ï¼Œreturnä¼šåœ¨finallyæ‰§è¡Œå®Œåæ‰§è¡Œï¼Œæœ€åçš„è¿”å›ç»“æœæ˜¯returnæ–¹æ³•çš„å‚æ•°ï¼Œè¿™ä¹‹åGeneratorè¿è¡Œç»“æŸï¼Œä¸‹æ¬¡è®¿é—®ä¼šå¾—åˆ°{value: undefined, done: true}</li><li><code>try ... finally</code>ä¸å­˜åœ¨æ—¶ï¼Œç›´æ¥æ‰§è¡Œreturnï¼Œåç»­å’Œä¸Šä¸€æ¡ä¸€è‡´</li></ul><h4 id="å®é™…ä¸Š"><a href="#å®é™…ä¸Š" class="headerlink" title="å®é™…ä¸Š"></a>å®é™…ä¸Š</h4><ul><li>ä»¥ä¸Šä¸‰ç§æ–¹æ³•éƒ½æ˜¯è®©Generatoræ¢å¤æ‰§è¡Œï¼Œå¹¶ç”¨è¯­å¥æ›¿æ¢yieldè¡¨è¾¾å¼</li></ul><h3 id="yield-è¡¨è¾¾å¼"><a href="#yield-è¡¨è¾¾å¼" class="headerlink" title="yield*è¡¨è¾¾å¼"></a><code>yield*</code>è¡¨è¾¾å¼</h3><ul><li><p>åœ¨ä¸€ä¸ªGeneratorå†…éƒ¨ç›´æ¥è°ƒç”¨å¦ä¸€ä¸ªGeneratoræ˜¯æ²¡ç”¨çš„ï¼Œå¦‚æœéœ€è¦åœ¨ä¸€ä¸ªGeneratorå†…éƒ¨yieldå¦ä¸€ä¸ªGeneratorå¯¹è±¡çš„æˆå‘˜ï¼Œåˆ™éœ€è¦ä½¿ç”¨<code>yield*</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">inner</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'a'</span></span><br><span class="line">  <span class="comment">// yield outer() // è¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">yield</span>* outer() <span class="comment">// è¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡çš„å†…éƒ¨å€¼</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'d'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">outer</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'b'</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'c'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> s = inner()</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> s) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i)</span><br><span class="line">&#125; <span class="comment">// a b c d</span></span><br></pre></td></tr></table></figure></li><li><p><code>yield*</code>åè·Ÿä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼ˆæ‰€æœ‰å®ç°äº†iteratorçš„æ•°æ®ç»“æ„å®é™…ä¸Šéƒ½å¯ä»¥è¢«<code>yield*</code>éå†ï¼‰</p></li><li><p>è¢«ä»£ç†çš„Generatorå‡½æ•°å¦‚æœæœ‰returnï¼Œreturnçš„å€¼ä¼šè¢«forâ€¦ofå¿½ç•¥ï¼Œæ‰€ä»¥nextä¸ä¼šè¿”å›ï¼Œä½†æ˜¯å®é™…ä¸Šå¯ä»¥å‘å¤–éƒ¨Generetorå†…éƒ¨è¿”å›ä¸€ä¸ªå€¼ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">"foo"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">var</span> v = <span class="keyword">yield</span> *foo();</span><br><span class="line">  <span class="built_in">console</span>.log( <span class="string">"v: "</span> + v );</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> it = bar();</span><br><span class="line">it.next()</span><br><span class="line"><span class="comment">// &#123;value: 1, done: false&#125;</span></span><br><span class="line">it.next()</span><br><span class="line"><span class="comment">// &#123;value: 2, done: false&#125;</span></span><br><span class="line">it.next()</span><br><span class="line"><span class="comment">// &#123;value: 3, done: false&#125;</span></span><br><span class="line">it.next();</span><br><span class="line"><span class="comment">// "v: foo"</span></span><br><span class="line"><span class="comment">// &#123;value: 4, done: false&#125;</span></span><br><span class="line">it.next()</span><br><span class="line"><span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure></li><li><p>ä¸¾ä¸ªğŸŒ°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤„ç†åµŒå¥—æ•°ç»„</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">Tree</span>(<span class="params">tree</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">Array</span>.isArray(tree))&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;tree.length;i++) &#123;</span><br><span class="line">      <span class="keyword">yield</span>* Tree(tree[i])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">yield</span> tree</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> ss = [[<span class="number">1</span>,<span class="number">2</span>],[<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],<span class="number">6</span>,[<span class="number">7</span>]]</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> Tree(ss)) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i)</span><br><span class="line">&#125; <span class="comment">// 1 2 3 4 5 6 7</span></span><br><span class="line"><span class="comment">// ç†è§£for ...of å®é™…ä¸Šæ˜¯ä¸€ä¸ªwhileå¾ªç¯</span></span><br><span class="line"><span class="keyword">var</span> it = iterateJobs(jobs);</span><br><span class="line"><span class="keyword">var</span> res = it.next();</span><br><span class="line"><span class="keyword">while</span> (!res.done)&#123;</span><br><span class="line">  <span class="keyword">var</span> result = res.value;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  res = it.next();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="Extra"><a href="#Extra" class="headerlink" title="Extra"></a>Extra</h3><h4 id="ä½œä¸ºå¯¹è±¡çš„å±æ€§çš„Generatorå‡½æ•°"><a href="#ä½œä¸ºå¯¹è±¡çš„å±æ€§çš„Generatorå‡½æ•°" class="headerlink" title="ä½œä¸ºå¯¹è±¡çš„å±æ€§çš„Generatorå‡½æ•°"></a>ä½œä¸ºå¯¹è±¡çš„å±æ€§çš„Generatorå‡½æ•°</h4><ul><li>å†™æ³•å¾ˆæ¸…å¥‡<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  * sss() &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> obj = =&#123;</span><br><span class="line">  sss: <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="Generatorå‡½æ•°çš„this"><a href="#Generatorå‡½æ•°çš„this" class="headerlink" title="Generatorå‡½æ•°çš„this"></a>Generatorå‡½æ•°çš„this</h4><ul><li><p>Generatorå‡½æ•°è¿”å›çš„æ˜¯éå†å™¨å¯¹è±¡ï¼Œä¼šç»§æ‰¿prototypeçš„æ–¹æ³•ï¼Œä½†æ˜¯ç”±äºè¿”å›çš„ä¸æ˜¯thisï¼Œæ‰€ä»¥ä¼šå‡ºç°ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">ss</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.a = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> f = ss()</span><br><span class="line">f.a <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure></li><li><p>æƒ³è¦åœ¨å†…éƒ¨çš„thisç»‘å®šéå†å™¨å¯¹è±¡ï¼Ÿjsçµæ´»ç‰¹æ€§å°½æ˜¾â€¦</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> * <span class="title">ss</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.a = <span class="number">1</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="keyword">this</span>.b = <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="keyword">this</span>.c = <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> f = ss.call(ss.prototype) <span class="comment">// ç”±äºf.__proto__ === ss.prototypeï¼Œä¼ å…¥éå†å™¨å¯¹è±¡çš„éšè—åŸå‹ç»™this</span></span><br><span class="line">f.next()</span><br><span class="line">f.next()</span><br><span class="line">f.a <span class="comment">// 1</span></span><br><span class="line">f.b <span class="comment">// 2</span></span><br><span class="line">f.c <span class="comment">// 3</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h4><ul><li><p>ä¸¾ä¸ªğŸŒ°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ©ç”¨æš‚åœçŠ¶æ€çš„ç‰¹æ€§</span></span><br><span class="line"><span class="keyword">let</span> clock = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'tick'</span>)</span><br><span class="line">    <span class="keyword">yield</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'tock'</span>)</span><br><span class="line">    <span class="keyword">yield</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å¼‚æ­¥æ“ä½œçš„åŒæ­¥åŒ–è¡¨è¾¾</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Generatorå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> result = <span class="keyword">yield</span> request(<span class="string">"http://some.url"</span>);</span><br><span class="line">  <span class="keyword">var</span> resp = <span class="built_in">JSON</span>.parse(result);</span><br><span class="line">    <span class="built_in">console</span>.log(resp.value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ajaxè¯·æ±‚å‡½æ•°ï¼Œå›è°ƒå‡½æ•°ä¸­è¦å°†responseä¼ ç»™nextæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  makeAjaxCall(url, <span class="function"><span class="keyword">function</span>(<span class="params">response</span>)</span>&#123;</span><br><span class="line">    it.next(response);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// éœ€è¦ç¬¬ä¸€æ¬¡æ‰§è¡Œnextæ–¹æ³•ï¼Œè¿”å›yieldåçš„è¡¨è¾¾å¼ï¼Œè§¦å‘å¼‚æ­¥è¯·æ±‚ï¼Œè·³åˆ°requestå‡½æ•°ä¸­æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">var</span> it = main();</span><br><span class="line">it.next();</span><br></pre></td></tr></table></figure></li><li><p>æ§åˆ¶æµç®¡ç†</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŒæ­¥steps</span></span><br><span class="line"><span class="keyword">let</span> steps = [step1Func, step2Func, step3Func];</span><br><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">iterateSteps</span>(<span class="params">steps</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt; steps.length; i++)&#123;</span><br><span class="line">    <span class="keyword">var</span> step = steps[i];</span><br><span class="line">    <span class="keyword">yield</span> step();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¼‚æ­¥åç»­è®¨è®º</span></span><br></pre></td></tr></table></figure></li><li><p>éƒ¨ç½²Iteratoræ¥å£</p></li><li>çœ‹åšæ•°ç»„ç»“æ„ä½¿ç”¨</li></ul><h2 id="lesson3-Generatorçš„å¼‚æ­¥åº”ç”¨"><a href="#lesson3-Generatorçš„å¼‚æ­¥åº”ç”¨" class="headerlink" title="lesson3 Generatorçš„å¼‚æ­¥åº”ç”¨"></a>lesson3 Generatorçš„å¼‚æ­¥åº”ç”¨</h2><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><h4 id="å¼‚æ­¥"><a href="#å¼‚æ­¥" class="headerlink" title="å¼‚æ­¥"></a>å¼‚æ­¥</h4><ul><li>ä¸€ä¸ªä»»åŠ¡æ‹†åˆ†æˆä¸¤ä¸ªé˜¶æ®µï¼Œæ¯”å¦‚ä»»åŠ¡æ˜¯è¯»å–ä¸€ä¸ªæ–‡ä»¶å¹¶è¿”å›ä¸€ä¸ªç»“æœaã€‚æ‹†åˆ†ä¸ºå‘æ“ä½œç³»ç»Ÿå‘èµ·è¯·æ±‚ï¼Œç„¶åæ‰§è¡Œåˆ«çš„æ“ä½œï¼Œå†åœ¨æ“ä½œç³»ç»Ÿè¿”å›æ–‡ä»¶ä»¥åå»è¿”å›ä¸€ä¸ªç»“æœaã€‚ä¸è¿ç»­çš„æ‰§è¡Œï¼Œç§°ä¸ºå¼‚æ­¥</li></ul><h4 id="å›è°ƒå‡½æ•°"><a href="#å›è°ƒå‡½æ•°" class="headerlink" title="å›è°ƒå‡½æ•°"></a>å›è°ƒå‡½æ•°</h4><ul><li>ä¼ ç»Ÿçš„å¼‚æ­¥å®ç°æ˜¯é€šè¿‡å°†ç¬¬äºŒé˜¶æ®µçš„æ“ä½œä»¥å‡½æ•°å½¢å¼ä½œä¸ºå‚æ•°ä¼ é€’åˆ°ä»»åŠ¡å¤„ç†æ–¹æ³•å†…ï¼Œåœ¨ç¬¬ä¸€é˜¶æ®µçš„æ‰§è¡Œæœ‰äº†ç»“æœä»¥åï¼Œå›è°ƒå‡½æ•°æ‰ä¼šæ‰§è¡Œ</li><li>nodeçº¦å®šï¼Œå›è°ƒå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»ä¸ºé”™è¯¯å¯¹è±¡ï¼Œå› ä¸ºç¬¬ä¸€é˜¶æ®µæ‰§è¡Œå®Œåï¼Œä»»åŠ¡å¾—ä¸Šä¸‹æ–‡ç¯å¢ƒç»“æŸäº†ã€‚è¿™ä¹‹åæŠ›å‡ºçš„é”™è¯¯éœ€è¦ä¼ å…¥å›è°ƒå‡½æ•°æ‰èƒ½è¢«æ•è·å¤„ç†</li><li>Promiseå…¶å®åªæ˜¯å†™æ³•ä¸Šçš„åŒºåˆ«ï¼Œä¾ç„¶æ˜¯ä»¥å›è°ƒå‡½æ•°çš„æ–¹å¼å®ç°å¼‚æ­¥</li></ul><h4 id="Generatorå‡½æ•°"><a href="#Generatorå‡½æ•°" class="headerlink" title="Generatorå‡½æ•°"></a>Generatorå‡½æ•°</h4><ul><li><p>åç¨‹coroutine<br>åç¨‹Aæ‰§è¡Œ-&gt;åç¨‹Aæš‚åœï¼Œæ‰§è¡Œæƒè½¬äº¤ç»™åç¨‹B-&gt;ä¸€æ®µæ—¶é—´åæ‰§è¡Œæƒäº¤è¿˜A-&gt;Aæ¢å¤æ‰§è¡Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// yieldæ˜¯å¼‚æ­¥ä¸¤ä¸ªé˜¶æ®µçš„åˆ†å‰²çº¿</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">asyncJob</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...å…¶ä»–ä»£ç </span></span><br><span class="line">  <span class="keyword">var</span> f = <span class="keyword">yield</span> readFile(fileA);</span><br><span class="line">  <span class="comment">// ...å…¶ä»–ä»£ç </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Generatorå‡½æ•°å®ç°åç¨‹<br>Generatorå‡½æ•°å®é™…ä¸Šå¯ä»¥ä½œä¸ºå¼‚æ­¥ä»»åŠ¡çš„å®¹å™¨ï¼Œåœ¨å¼‚æ­¥ä»»åŠ¡éœ€è¦æš‚åœçš„åœ°æ–¹åŠ ä¸Šyieldæ³¨æ˜å³å¯</p></li><li><p>Generatorå‡½æ•°çš„é”™è¯¯å¤„ç†å’Œæ•°æ®äº¤æ¢<br>nextæ–¹æ³•ä½¿å¾—Generatorå¯ä»¥æ¥æ”¶å¤–éƒ¨å‚æ•°ï¼Œnextè¿”å›å€¼çš„valueå±æ€§æ˜¯Generatorå‘å¤–çš„è¾“å‡ºå€¼ï¼ˆæ•°æ®äº¤æ¢å®ç°ï¼‰<br>é”™è¯¯å¤„ç†ä¸Šä¸€è¯¾æœ‰è®²è¿°</p></li></ul><h3 id="Thunkå‡½æ•°"><a href="#Thunkå‡½æ•°" class="headerlink" title="Thunkå‡½æ•°"></a>Thunkå‡½æ•°</h3><h4 id="å‚æ•°çš„æ±‚å€¼ç­–ç•¥"><a href="#å‚æ•°çš„æ±‚å€¼ç­–ç•¥" class="headerlink" title="å‚æ•°çš„æ±‚å€¼ç­–ç•¥"></a>å‚æ•°çš„æ±‚å€¼ç­–ç•¥</h4><ul><li>ä¼ åè°ƒç”¨å’Œä¼ å€¼è°ƒç”¨ä¹‹äº‰</li><li>åè€…æ›´ç®€å•ï¼Œä½†æ˜¯å¯èƒ½ä¼šæœ‰éœ€è¦å¤§é‡è®¡ç®—æ±‚å€¼å´æ²¡æœ‰ç”¨åˆ°è¿™ä¸ªå‚æ•°çš„æƒ…å†µï¼Œé€ æˆæ€§èƒ½æŸå¤±</li></ul><h4 id="jsä¸­çš„Thunkå‡½æ•°"><a href="#jsä¸­çš„Thunkå‡½æ•°" class="headerlink" title="jsä¸­çš„Thunkå‡½æ•°"></a>jsä¸­çš„Thunkå‡½æ•°</h4><ul><li>ä¼ ç»Ÿçš„Thunkå‡½æ•°æ˜¯ä¼ åè°ƒç”¨çš„ä¸€ç§å®ç°ï¼Œå³å°†å‚æ•°ä½œä¸ºä¸€ä¸ªä¸´æ—¶å‡½æ•°çš„è¿”å›å€¼ï¼Œåœ¨éœ€è¦ç”¨åˆ°å‚æ•°çš„åœ°æ–¹å¯¹ä¸´æ—¶å‡½æ•°è¿›è¡Œæ±‚å€¼</li><li><p>jsä¸­çš„Thunkå‡½æ•°ç•¥æœ‰ä¸åŒ<br>jsä¸­çš„Thunkå‡½æ•°æ˜¯å°†å¤šå‚æ•°å‡½æ•°æ›¿æ¢ä¸ºå•å‚æ•°å‡½æ•°ï¼ˆè¿™ä¸ªå‚æ•°ä¸ºå›è°ƒå‡½æ•°ï¼‰</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Thunk = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> fn.call(<span class="keyword">this</span>, ...args, callback);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥åªæ˜¯æ¢äº†ä¸ªæ ·å­ï¼Œå¥½åƒå¹¶æ²¡æœ‰ä»€ä¹ˆç”¨</p></li></ul><h4 id="Thunkå‡½æ•°å®ç°Generatorå‡½æ•°è‡ªåŠ¨æ‰§è¡Œ"><a href="#Thunkå‡½æ•°å®ç°Generatorå‡½æ•°è‡ªåŠ¨æ‰§è¡Œ" class="headerlink" title="Thunkå‡½æ•°å®ç°Generatorå‡½æ•°è‡ªåŠ¨æ‰§è¡Œ"></a>Thunkå‡½æ•°å®ç°Generatorå‡½æ•°è‡ªåŠ¨æ‰§è¡Œ</h4><ul><li><p>Generatorå‡½æ•°è‡ªåŠ¨æ‰§è¡Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> a <span class="comment">// è¡¨è¾¾å¼a</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> g = gen()</span><br><span class="line"><span class="keyword">let</span> res = g.next()</span><br><span class="line"><span class="keyword">while</span>(!res.done) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res.value)</span><br><span class="line">  res = g.next() <span class="comment">// è¡¨è¾¾å¼b</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä½†æ˜¯ï¼Œè¿™ä¸é€‚åˆå¼‚æ­¥æ“ä½œã€‚å¦‚æœå¿…é¡»ä¿è¯å‰ä¸€æ­¥æ‰§è¡Œå®Œï¼Œæ‰èƒ½æ‰§è¡Œåä¸€æ­¥ï¼Œä¸Šé¢çš„è‡ªåŠ¨æ‰§è¡Œå°±ä¸å¯è¡Œã€‚<br><del>ä¸Šé¢è¿™å¥è¯æ˜¯ä¸æ˜¯å¯ä»¥è¿™æ ·ç†è§£ï¼Œæ¯”å¦‚è¡¨è¾¾å¼aæ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œå›è°ƒå‡½æ•°ä¸­è®¾ç½®äº†å»¶æ—¶æ‰§è¡Œï¼Œè€Œè¿™ä¸ªå›è°ƒå‡½æ•°æ‰§è¡Œå‰è¡¨è¾¾å¼bå¯èƒ½å·²ç»è¢«æ‰§è¡Œäº†ï¼Œè¿›å…¥åˆ°ä¸‹ä¸€ä¸ªå¾ªç¯ã€‚æ‰€ä»¥æ— æ³•ä¿è¯æ‰§è¡Œé¡ºåºï¼Œæ‰€ä»¥éœ€è¦ç®¡ç†å›è°ƒå‡½æ•°</del><br>nextæ–¹æ³•æ˜¯åŒæ­¥çš„ï¼Œæ‰§è¡Œæ—¶å¿…é¡»ç«‹åˆ»è¿”å›å€¼ï¼Œyieldåæ˜¯åŒæ­¥æ“ä½œå½“ç„¶æ²¡é—®é¢˜ï¼Œæ˜¯å¼‚æ­¥æ“ä½œæ—¶å°±ä¸å¯ä»¥äº†ã€‚å¤„ç†æ–¹å¼å°±æ˜¯è¿”å›ä¸€ä¸ªThunkå‡½æ•°æˆ–è€…Promiseå¯¹è±¡ã€‚æ­¤æ—¶valueå€¼ä¸ºè¯¥å‡½æ•°/å¯¹è±¡ï¼Œdoneå€¼è¿˜æ˜¯æŒ‰è§„çŸ©åŠäº‹ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> g = gen();</span><br><span class="line"><span class="keyword">var</span> r1 = g.next();</span><br><span class="line"><span class="comment">// é‡å¤ä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°</span></span><br><span class="line">r1.value(<span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">  <span class="keyword">var</span> r2 = g.next(data);</span><br><span class="line">  r2.value(<span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">    g.next(data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></blockquote></li><li><p>Thunkå‡½æ•°çš„è‡ªåŠ¨æµç¨‹ç®¡ç†<br>æ€è·¯ï¼šGeneratorå‡½æ•°ä¸­yield å¼‚æ­¥Thunkå‡½æ•°ï¼Œé€šè¿‡yieldå°†æ§åˆ¶æƒè½¬äº¤ç»™Thunkå‡½æ•°ï¼Œç„¶ååœ¨Thunkå‡½æ•°çš„å›è°ƒå‡½æ•°ä¸­è°ƒç”¨Generatorçš„nextæ–¹æ³•ï¼Œå°†æ§åˆ¶æƒäº¤å›ç»™Generatorã€‚æ­¤æ—¶ï¼Œå¼‚æ­¥æ“ä½œç¡®ä¿å®Œæˆï¼Œå¼€å¯ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚<br>Generatoræ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„å®¹å™¨ï¼Œå®ç°è‡ªåŠ¨æ‰§è¡Œéœ€è¦ä¸€ä¸ªæœºåˆ¶ï¼Œè¿™ä¸ªæœºåˆ¶çš„å…³é”®æ˜¯æ§åˆ¶æƒçš„äº¤æ›¿ï¼Œåœ¨å¼‚æ­¥æ“ä½œæœ‰äº†ç»“æœä»¥åè‡ªåŠ¨äº¤å›æ§åˆ¶æƒï¼Œè€Œå›è°ƒå‡½æ•°æ‰§è¡Œæ­£æ˜¯è¿™ä¹ˆä¸ªæ—¶é—´ç‚¹ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Generatorå‡½æ•°çš„æ‰§è¡Œå™¨</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> gen = fn()</span><br><span class="line">  <span class="comment">// ä¼ ç»™Thunkå‡½æ•°çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">cb</span>(<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// æ§åˆ¶æƒäº¤ç»™Generatorï¼Œè·å–ä¸‹ä¸€ä¸ªyieldè¡¨è¾¾å¼ï¼ˆå¼‚æ­¥ä»»åŠ¡ï¼‰</span></span><br><span class="line">    <span class="keyword">let</span> result = gen.next(data)</span><br><span class="line">    <span class="comment">// æ²¡ä»»åŠ¡äº†ï¼Œè¿”å›</span></span><br><span class="line">    <span class="keyword">if</span> (result.done) <span class="keyword">return</span></span><br><span class="line">    <span class="comment">// æ§åˆ¶æƒäº¤ç»™Thunkå‡½æ•°ï¼Œä¼ å…¥å›è°ƒ</span></span><br><span class="line">    result.value(cb)</span><br><span class="line">  &#125;</span><br><span class="line">  cb()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Generatorå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">g</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> f1 = <span class="keyword">yield</span> readFileThunk(<span class="string">'/a'</span>)</span><br><span class="line">  <span class="keyword">let</span> f2 = <span class="keyword">yield</span> readFileThunk(<span class="string">'/b'</span>)</span><br><span class="line">  <span class="keyword">let</span> f3 = <span class="keyword">yield</span> readFileThunk(<span class="string">'/c'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Thunkå‡½æ•°readFileThunk</span></span><br><span class="line"><span class="keyword">const</span> Thunk = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> fn.call(<span class="keyword">this</span>, ...args, callback);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> readFileThunk = Thunk(fs.readFile);</span><br><span class="line">readFileThunk(fileA)(callback);</span><br><span class="line"><span class="comment">// è‡ªåŠ¨æ‰§è¡Œ</span></span><br><span class="line">run(g)</span><br></pre></td></tr></table></figure></li></ul><h3 id="coæ¨¡å—"><a href="#coæ¨¡å—" class="headerlink" title="coæ¨¡å—"></a>coæ¨¡å—</h3><h4 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h4><ul><li>ä¸ç”¨æ‰‹å†™ä¸Šè¿°çš„æ‰§è¡Œå™¨ï¼Œcoæ¨¡å—å…¶å®å°±æ˜¯å°†åŸºäºThunkå‡½æ•°å’ŒPromiseå¯¹è±¡çš„ä¸¤ç§è‡ªåŠ¨Generatoræ‰§è¡Œå™¨åŒ…è£…æˆä¸€ä¸ªæ¨¡å—</li><li>ä½¿ç”¨æ¡ä»¶ï¼šyieldååªèƒ½ä¸ºThunkå‡½æ•°æˆ–Promiseå¯¹è±¡æˆ–Promiseå¯¹è±¡æ•°ç»„</li></ul><h4 id="åŸºäºPromiseçš„æ‰§è¡Œå™¨"><a href="#åŸºäºPromiseçš„æ‰§è¡Œå™¨" class="headerlink" title="åŸºäºPromiseçš„æ‰§è¡Œå™¨"></a>åŸºäºPromiseçš„æ‰§è¡Œå™¨</h4><ul><li>å®ç°<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> gen = fn()</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">cb</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å°†ä¸Šä¸€ä¸ªä»»åŠ¡è¿”å›çš„dataä½œä¸ºå‚æ•°ä¼ ç»™nextæ–¹æ³•ï¼Œæ§åˆ¶æƒäº¤å›åˆ°Generator</span></span><br><span class="line">    <span class="comment">//è¿™é‡Œå°†resultå˜é‡å¼•ç”¨&#123;value, done&#125;å¯¹è±¡ï¼Œä¸è¦å’ŒGeneratorä¸­çš„`let result = yield xxx`ææ··</span></span><br><span class="line">    <span class="keyword">let</span> result = gen.next(data)</span><br><span class="line">    <span class="keyword">if</span> (result.done) <span class="keyword">return</span> result.value</span><br><span class="line">    result.value.then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">      <span class="comment">// resolvedä¹‹åä¼šæ‰§è¡Œcb(data)ï¼Œå¼€å¯ä¸‹ä¸€æ¬¡å¾ªç¯ï¼Œå®ç°è‡ªåŠ¨æ‰§è¡Œ</span></span><br><span class="line">      cb(data)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  cb()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h4><ul><li><p>å…¶å®å’Œä¸Šé¢çš„å®ç°ç±»ä¼¼</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">co</span>(<span class="params">gen</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">var</span> args = slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>) <span class="comment">// é™¤ç¬¬ä¸€ä¸ªå‚æ•°å¤–çš„æ‰€æœ‰å‚æ•°</span></span><br><span class="line">  <span class="comment">// è¿”å›ä¸€ä¸ªPromiseå¯¹è±¡</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯Generatorå‡½æ•°ï¼Œæ‰§è¡Œè·å–éå†å™¨å¯¹è±¡gen</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> gen === <span class="string">'function'</span>) gen = gen.apply(ctx, args);</span><br><span class="line">    <span class="keyword">if</span> (!gen || <span class="keyword">typeof</span> gen.next !== <span class="string">'function'</span>) <span class="keyword">return</span> resolve(gen);</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ¬¡æ‰§è¡Œéå†å™¨å¯¹è±¡gençš„nextæ–¹æ³•è·å–ç¬¬ä¸€ä¸ªä»»åŠ¡</span></span><br><span class="line">    onFulfilled();</span><br><span class="line">    <span class="comment">// æ¯æ¬¡å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå®Œï¼Œresolvedä»¥åä¼šè°ƒç”¨ï¼Œæ§åˆ¶æƒåˆäº¤è¿˜ç»™Generator</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">onFulfilled</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> ret;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        ret = gen.next(res); <span class="comment">// è·å–&#123;value,done&#125;å¯¹è±¡ï¼Œæ§åˆ¶æƒåœ¨è¿™é‡Œæš‚æ—¶äº¤ç»™å¼‚æ­¥ä»»åŠ¡ï¼Œæ‰§è¡Œyieldåçš„å¼‚æ­¥ä»»åŠ¡</span></span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="keyword">return</span> reject(e);</span><br><span class="line">      &#125;</span><br><span class="line">      next(ret); <span class="comment">// è¿›å…¥nextæ–¹æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åŒç†å¯å¾—</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">onRejected</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> ret;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        ret = gen.throw(err);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="keyword">return</span> reject(e);</span><br><span class="line">      &#125;</span><br><span class="line">      next(ret);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å…³é”®</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">next</span>(<span class="params">ret</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// éå†æ‰§è¡Œå®Œå¼‚æ­¥ä»»åŠ¡åï¼Œç½®ä¸ºresolvedï¼Œå¹¶å°†æœ€åvalueå€¼è¿”å›</span></span><br><span class="line">      <span class="keyword">if</span> (ret.done) <span class="keyword">return</span> resolve(ret.value);</span><br><span class="line">      <span class="comment">// è·å–ä¸‹ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œå¹¶è½¬ä¸ºPromiseå¯¹è±¡</span></span><br><span class="line">      <span class="keyword">var</span> value = toPromise.call(ctx, ret.value);</span><br><span class="line">      <span class="comment">// å¼‚æ­¥ä»»åŠ¡ç»“æŸåä¼šè°ƒç”¨onFulfilledæ–¹æ³•ï¼ˆåœ¨è¿™é‡Œä¸ºyieldåçš„å¼‚æ­¥ä»»åŠ¡è®¾ç½®thençš„å›è°ƒå‚æ•°ï¼‰</span></span><br><span class="line">      <span class="keyword">if</span> (value &amp;&amp; isPromise(value)) <span class="keyword">return</span> value.then(onFulfilled, onRejected);</span><br><span class="line">      <span class="keyword">return</span> onRejected(<span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'You may only yield a function, promise, generator, array, or object, '</span></span><br><span class="line">        + <span class="string">'but the following object was passed: "'</span> + <span class="built_in">String</span>(ret.value) + <span class="string">'"'</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®è¿˜æ˜¯ä¸€æ ·ï¼Œä¸ºPromiseå¯¹è±¡thenæ–¹æ³•æŒ‡å®šå›è°ƒå‡½æ•°ï¼Œåœ¨å¼‚æ­¥ä»»åŠ¡å®Œæˆåå‡ºå‘å›è°ƒå‡½æ•°ï¼Œåœ¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡ŒGeneratorçš„nextæ–¹æ³•ï¼Œè¿›å…¥ä¸‹ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œå®ç°è‡ªåŠ¨æ‰§è¡Œã€‚<br>ä¸¾ä¸ªğŸŒ°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> co =<span class="built_in">require</span>(<span class="string">'co'</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params">filename</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    fs.readFile(filename, <span class="string">'utf8'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, res</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> reject(err);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> resolve(res);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">co(<span class="function"><span class="keyword">function</span> *(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">yield</span> read(<span class="string">'./a.js'</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><p>å¤„ç†å¹¶å‘çš„å¼‚æ­¥æ“ä½œ<br>æŠŠå¹¶å‘æ“ä½œæ”¾æ•°ç»„/å¯¹è±¡ä¸­æ”¾yieldåé¢</p></li></ul><h2 id="lesson4-asyncå‡½æ•°"><a href="#lesson4-asyncå‡½æ•°" class="headerlink" title="lesson4 asyncå‡½æ•°"></a>lesson4 asyncå‡½æ•°</h2><h3 id="è¯­æ³•ç³–"><a href="#è¯­æ³•ç³–" class="headerlink" title="è¯­æ³•ç³–"></a>è¯­æ³•ç³–</h3><ul><li><p>æ¯”è¾ƒ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">asyncReadFile</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> f1 = <span class="keyword">yield</span> readFile(<span class="string">'/etc/fstab'</span>);</span><br><span class="line">  <span class="keyword">const</span> f2 = <span class="keyword">yield</span> readFile(<span class="string">'/etc/shells'</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(f1.toString());</span><br><span class="line">  <span class="built_in">console</span>.log(f2.toString());</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> asyncReadFile = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> f1 = <span class="keyword">await</span> readFile(<span class="string">'/etc/fstab'</span>);</span><br><span class="line">  <span class="keyword">const</span> f2 = <span class="keyword">await</span> readFile(<span class="string">'/etc/shells'</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(f1.toString());</span><br><span class="line">  <span class="built_in">console</span>.log(f2.toString());</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥åªæ˜¯å†™æ³•çš„æ›¿æ¢ï¼Œå®é™…ä¸Šæœ‰è¿™æ ·çš„åŒºåˆ«</p><ul><li>asyncå‡½æ•°å†…ç½®æ‰§è¡Œå™¨ï¼Œä¸éœ€è¦æ‰‹åŠ¨æ‰§è¡Œnextæ–¹æ³•ï¼Œä¸éœ€è¦å¼•å…¥coæ¨¡å—</li><li>asyncé€‚ç”¨æ›´å¹¿ï¼Œcoæ¨¡å—å¯¹yieldåçš„å†…å®¹ä¸¥æ ¼é™åˆ¶ä¸ºThunkå‡½æ•°æˆ–Promiseå¯¹è±¡ï¼Œè€Œawaitåå¯ä»¥æ˜¯Promiseå¯¹è±¡æˆ–åŸå§‹ç±»å‹å€¼</li><li>è¿”å›Promiseï¼Œè¿™ç‚¹å’Œcoæ¯”è¾ƒåƒ</li></ul></li><li><p>ç”¨æ³•</p><ul><li>asyncæ ‡è¯†è¯¥å‡½æ•°å†…éƒ¨æœ‰å¼‚æ­¥æ“ä½œ</li><li>ç”±äºasyncå‡½æ•°è¿”å›çš„æ˜¯Promiseï¼Œæ‰€ä»¥å¯ä»¥å°†asyncå‡½æ•°ä½œä¸ºawaitå‘½ä»¤çš„å‚æ•°</li><li>asyncå‡½æ•°å¯ä»¥ä½¿ç”¨åœ¨å‡½æ•°ã€æ–¹æ³•é€‚ç”¨çš„è®¸å¤šåœºæ™¯</li></ul></li></ul><h3 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><h4 id="è¿”å›çš„Promise"><a href="#è¿”å›çš„Promise" class="headerlink" title="è¿”å›çš„Promise"></a>è¿”å›çš„Promise</h4><ul><li>asyncå‡½æ•°åªæœ‰åœ¨æ‰€æœ‰awaitåçš„Promiseæ‰§è¡Œå®Œä»¥åæ‰ä¼šæ”¹å˜è¿”å›çš„Promiseå¯¹è±¡çš„çŠ¶æ€ï¼ˆreturnæˆ–è€…æŠ›é”™é™¤å¤–ï¼‰å³åªæœ‰åœ¨å†…éƒ¨æ“ä½œå®Œæˆä»¥åæ‰ä¼šæ‰§è¡Œthenæ–¹æ³•</li><li>asyncå‡½æ•°å†…éƒ¨returnçš„å€¼ä¼šä½œä¸ºè¿”å›çš„Promiseçš„thenæ–¹æ³•å›è°ƒå‡½æ•°çš„å‚æ•°</li><li>asyncå‡½æ•°å†…éƒ¨æŠ›å‡ºçš„é”™è¯¯ä¼šä½¿å¾—è¿”å›çš„Promiseå˜æˆrejectedçŠ¶æ€ï¼ŒåŒæ—¶é”™è¯¯ä¼šè¢«catchæ•è·</li></ul><h4 id="asyncå‘½ä»¤åŠå…¶åçš„Promise"><a href="#asyncå‘½ä»¤åŠå…¶åçš„Promise" class="headerlink" title="asyncå‘½ä»¤åŠå…¶åçš„Promise"></a>asyncå‘½ä»¤åŠå…¶åçš„Promise</h4><ul><li>asyncå‘½ä»¤åå¦‚æœä¸æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œåˆ™ä¼šè¢«è½¬æˆä¸€ä¸ªresolvedçš„Promise</li><li>asyncå‘½ä»¤åçš„Promiseå¦‚æœæŠ›é”™äº†å˜æˆrejectedçŠ¶æ€æˆ–è€…ç›´æ¥rejectedäº†ï¼Œéƒ½ä¼šä½¿å¾—asyncå‡½æ•°çš„æ‰§è¡Œä¸­æ–­ï¼Œé”™è¯¯å¯ä»¥è¢«thenæ–¹æ³•çš„å›è°ƒå‡½æ•°catchåˆ°</li><li>å¦‚æœå¸Œæœ›asyncçš„ä¸€ä¸ªawait Promiseä¸å½±å“åˆ°å…¶ä»–çš„await Promiseï¼Œå¯ä»¥å°†è¿™ä¸ªawait Promiseæ”¾åˆ°ä¸€ä¸ªtryâ€¦catchä»£ç å—ä¸­ï¼Œè¿™æ ·åé¢çš„ä¾ç„¶ä¼šæ­£å¸¸æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥å°†å¤šä¸ªawait Promiseæ”¾åœ¨ä¸€ä¸ªtryâ€¦catchä»£ç å—ä¸­ï¼Œæ­¤å¤–è¿˜å¯ä»¥åŠ ä¸Šé”™è¯¯é‡è¯•</li></ul><h4 id="ä½¿ç”¨æ³¨æ„"><a href="#ä½¿ç”¨æ³¨æ„" class="headerlink" title="ä½¿ç”¨æ³¨æ„"></a>ä½¿ç”¨æ³¨æ„</h4><ul><li><p>ç›¸äº’ç‹¬ç«‹çš„å¼‚æ­¥ä»»åŠ¡å¯ä»¥æ”¹é€ ä¸‹è®©å…¶å¹¶å‘æ‰§è¡Œï¼ˆPromise.allï¼‰</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [foo, bar] = <span class="keyword">await</span> <span class="built_in">Promise</span>.all([getFoo(), getBar()]);</span><br><span class="line"><span class="comment">// å¬è¯´ä¸‹é¢è¿™ç§ä¹Ÿå¯ä»¥ï¼Ÿ</span></span><br><span class="line"><span class="keyword">let</span> fooPromise = getFoo();</span><br><span class="line"><span class="keyword">let</span> barPromise = getBar();</span><br><span class="line"><span class="keyword">let</span> foo = <span class="keyword">await</span> fooPromise;</span><br><span class="line"><span class="keyword">let</span> bar = <span class="keyword">await</span> barPromise;</span><br></pre></td></tr></table></figure></li><li><p>forEach</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">forEach(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> m = <span class="keyword">await</span> pro</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿™ç§å†™æ³•å¯èƒ½ä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œå› ä¸ºforEachæ—¶çš„è‹¥å¹²ä¸ªæ“ä½œæ˜¯å¹¶è¡Œçš„ï¼Œåº”æ”¹ä¸ºforå¾ªç¯</p></li></ul><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><ul><li>å…¶å®å°±æ˜¯å°†æ‰§è¡Œå™¨å’ŒGeneratorå‡½æ•°å°è£…åœ¨ä¸€èµ·ï¼Œè¯¦è§ä¸Šä¸€è¯¾</li></ul><h3 id="ä¸¾ä¸¾ğŸŒ°"><a href="#ä¸¾ä¸¾ğŸŒ°" class="headerlink" title="ä¸¾ä¸¾ğŸŒ°"></a>ä¸¾ä¸¾ğŸŒ°</h3><ul><li>å¹¶å‘è¯·æ±‚ï¼Œé¡ºåºè¾“å‡º<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">logInOrder</span>(<span class="params">urls</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å¹¶å‘è¯»å–è¿œç¨‹URL</span></span><br><span class="line">  <span class="keyword">const</span> textPromises = urls.map(<span class="keyword">async</span> url =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> fetch(url);</span><br><span class="line">    <span class="keyword">return</span> response.text();</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// æŒ‰æ¬¡åºè¾“å‡º</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> textPromise <span class="keyword">of</span> textPromises) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">await</span> textPromise);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="å¼‚æ­¥éå†å™¨"><a href="#å¼‚æ­¥éå†å™¨" class="headerlink" title="å¼‚æ­¥éå†å™¨"></a>å¼‚æ­¥éå†å™¨</h3><h4 id="å›åˆ°è¿‡å»"><a href="#å›åˆ°è¿‡å»" class="headerlink" title="å›åˆ°è¿‡å»"></a>å›åˆ°è¿‡å»</h4><ul><li>Generatorçš„nextæ–¹æ³•æ˜¯åŒæ­¥çš„ï¼Œéœ€è¦ç«‹å³è¿”å›ç»“æœï¼Œæ‰€ä»¥åœ¨å¤„ç†å¼‚æ­¥æ“ä½œæ—¶æˆ‘ä»¬è¿”å›çš„å®é™…ä¸Šæ˜¯{value: Promise, done: false}ç±»ä¼¼è¿™æ ·çš„å¯¹è±¡ã€‚ç†è§£æ²¡é”™çš„è¯Promiseå¯¹è±¡åˆ›å»ºæ—¶ä¼ å…¥çš„å‡½æ•°ä¼šç«‹å³æ‰§è¡Œï¼Œå¼‚æ­¥æ“ä½œä¾‹å¦‚è¯»å–æ–‡ä»¶è¯·æ±‚å°±å¼€å§‹äº†ã€‚è€Œåæˆ‘ä»¬ä¸ºè¿™ä¸ªPromiseå¯¹è±¡æŒ‡å®šthenæ–¹æ³•çš„å‚æ•°å›è°ƒå‡½æ•°å»æ¥æ”¶å¼‚æ­¥æ“ä½œå®Œæˆçš„ä¿¡å·ï¼Œç„¶ååœ¨å›è°ƒå‡½æ•°ä¸­å†æ¬¡è°ƒç”¨nextè·å–ä¸‹ä¸€ä¸ª{value: Promise, done: false}</li><li>ææ¡ˆï¼šä¸ºå¼‚æ­¥æ“ä½œæä¾›åŸç”Ÿçš„éå†å™¨æ¥å£ï¼Œä½¿å¾—valueå’Œdoneå€¼éƒ½å¯ä»¥å¼‚æ­¥è¿”å›ï¼Œç§°ä¸ºå¼‚æ­¥éå†å™¨</li></ul><h4 id="more"><a href="#more" class="headerlink" title="more"></a>more</h4><ul><li>ç´¯äº†ï¼Œå›°äº†ï¼Œä¸å¼€å¿ƒçœ‹äº†ï¼Œä¸‹æ¬¡å†è¡¥å……</li></ul></div></div><div class="article-footer"><div class="article-meta pull-left"><span class="post-categories"><i class="icon-categories"></i> <a href="/categories/code/">code</a> </span><span class="post-tags"><i class="icon-tags"></i> <a href="/tags/js/">js</a></span></div></div></article></main><footer class="site-footer"><p class="site-info">Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a><br>&copy; 2018 Derek Zhou</p></footer></div></div></body></html>