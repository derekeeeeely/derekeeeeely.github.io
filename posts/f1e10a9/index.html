<!DOCTYPE HTML><html><head><meta charset="utf-8"><title>js-es6 æ–°ç‰¹æ€§ç¯‡ | DZ&#39;s Gensokyo | Best Time, Best You and Me</title><meta name="author" content="Derek Zhou"><meta name="description" content="life are flashes and here is my life"><meta name="keywords" content="js"><meta id="viewport" name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta property="og:title" content="js-es6 æ–°ç‰¹æ€§ç¯‡"><meta property="og:site_name" content="DZ&#39;s Gensokyo"><meta property="og:image" content="/favicon.ico"><link href="/favicon.ico" rel="icon"><link rel="alternate" href="/atom.xml" title="DZ&#39;s Gensokyo" type="application/atom+xml"><link rel="stylesheet" href="/css/style.css" media="screen" type="text/css"></head><body><div class="blog"><div class="content"><header><div class="site-branding"><h1 class="site-title"><a href="/">DZ&#39;s Gensokyo</a></h1><p class="site-description">Best Time, Best You and Me</p></div><nav class="site-navigation"><ul><li><a href="/">ä¸»é¡µ</a></li><li><a href="/archives">å½’æ¡£</a></li><li><a href="/tags">æ ‡ç­¾</a></li><li><a href="/about">å…³äº</a></li></ul></nav></header><main class="site-main posts-loop"><article><h3 class="article-title"><span>js-es6 æ–°ç‰¹æ€§ç¯‡</span></h3><div class="article-top-meta"><span class="posted-on"><a href="/posts/f1e10a9/" rel="bookmark"><time class="entry-date published" datetime="2017-11-06T06:12:52.000Z">2017-11-06</time></a></span></div><div class="article-content"><div class="entry"><p>&emsp;&emsp;æ‰¿ä¸Šä¸€ç¯‡ï¼Œæœ¬ç¬”è®°åŒ…å«es6çš„ä¸€äº›æ–°ä¸œè¥¿ï¼Œå¦‚Reflectï¼ŒProxyï¼ŒIteratorï¼ŒSymbolç­‰ã€‚<br><a id="more"></a></p><h2 id="lesson1-Symbol"><a href="#lesson1-Symbol" class="headerlink" title="lesson1 Symbol"></a>lesson1 Symbol</h2><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><ul><li><p>javaScriptç¬¬ä¸ƒç§åŸå§‹æ•°æ®ç±»å‹Symbol<br><code>let s = Symbol(&#39;foo&#39;)</code><br>é€šè¿‡Symbolå‡½æ•°ç”Ÿæˆï¼Œæ¯ä¸ªSymbolç±»å‹çš„å˜é‡å€¼éƒ½ç‹¬ä¸€æ— äºŒï¼Œä½œä¸ºä¸€ç§ç±»ä¼¼äºå­—ç¬¦ä¸²çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥é¿å…å˜é‡åå†²çª<br>Symbolå‡½æ•°æ¥æ”¶ä¸€ä¸ªå‚æ•°ç”¨äºæè¿°è¯¥Symbolå®ä¾‹ï¼Œä¸å½±å“ç”Ÿæˆçš„Symbolå®ä¾‹çš„å€¼<br>Symbolå€¼ä¸èƒ½ä¸å…¶ä»–ç±»å‹è¿›è¡Œè¿ç®—ï¼ˆæ¨¡æ¿å­—ç¬¦ä¸²ä¸­ä¹Ÿä¸å¯ä»¥ï¼‰ï¼Œå¯ä»¥æ˜¾ç¤ºè½¬ä¸ºå­—ç¬¦ä¸²å’Œå¸ƒå°”å€¼ï¼ˆString(), Boolean()ï¼‰</p></li><li><p>Symbolä½œä¸ºå±æ€§å</p><ul><li>ä¸èƒ½ç”¨<code>.</code>ï¼Œå› ä¸º<code>.</code>æ˜¯å»å–å­—ç¬¦ä¸²å¯¹åº”å±æ€§å</li><li>åœ¨å¯¹è±¡ä¸­ä½¿ç”¨ä½œä¸ºå±æ€§åæ—¶ï¼Œéœ€ä½¿ç”¨<code>[s]</code>å¦åˆ™ä¹Ÿä¼šè¢«å½“åšå­—ç¬¦ä¸²</li></ul></li><li><p><code>Symbol.for</code>, <code>Symbol.keyFor</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 = <span class="built_in">Symbol</span>.for(<span class="string">"foo"</span>);</span><br><span class="line"><span class="built_in">Symbol</span>.keyFor(s1) <span class="comment">// "foo"</span></span><br><span class="line"><span class="keyword">let</span> s2 = <span class="built_in">Symbol</span>(<span class="string">"foo"</span>); <span class="comment">// å…ˆæœç´¢å…¨å±€ï¼Œå·²å­˜åœ¨è¯¥keyåˆ™è¿”å›å·²å­˜åœ¨çš„</span></span><br><span class="line"><span class="built_in">Symbol</span>.keyFor(s2) <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="å†…ç½®Symbolå€¼"><a href="#å†…ç½®Symbolå€¼" class="headerlink" title="å†…ç½®Symbolå€¼"></a>å†…ç½®Symbolå€¼</h3><ul><li><p><code>Symbol.hasInstance</code><br>å¯¹è±¡çš„<code>Symbol.hasInstance</code>å±æ€§æŒ‡å‘ä¸€ä¸ªå†…éƒ¨æ–¹æ³•ï¼Œå…¶ä»–å¯¹è±¡ä½¿ç”¨instanceOfåˆ¤æ–­å®ä¾‹æ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ªå†…éƒ¨æ–¹æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Even</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> [<span class="built_in">Symbol</span>.hasInstance](obj) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Number</span>(obj) % <span class="number">2</span> === <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">1</span> instanceOf Even</span><br></pre></td></tr></table></figure></li><li><p><code>Symbol.isConcatSpreadable</code><br>è¡¨ç¤ºè¯¥å¯¹è±¡ç”¨äºArray.prototype.concat()æ—¶æ˜¯å¦å¯ä»¥å±•å¼€ï¼Œæ•°ç»„é»˜è®¤å¯å±•å¼€ï¼Œé»˜è®¤å€¼ä¸ºundefinedï¼Œå¯¹è±¡é»˜è®¤ä¸å¯å±•å¼€</p></li><li><p><code>Symbol.species</code><br>æŒ‡å‘å½“å‰å¯¹è±¡çš„æ„é€ å‡½æ•°ï¼Œåˆ›é€ å®ä¾‹æ—¶ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå³ä½¿ç”¨è¯¥å±æ€§è¿”å›çš„å‡½æ•°ä½œä¸ºæ„é€ å‡½æ•°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> get [<span class="built_in">Symbol</span>.species]() &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>Symbol.match</code>, <code>Symbol.replace</code>, <code>Symbol.split</code>, <code>Symbol.search</code></p></li><li><code>Symbol.iterator</code><br>æŒ‡å‘è¯¥å¯¹è±¡çš„é»˜è®¤éå†å™¨æ–¹æ³•<br>å¯¹è±¡è¿›è¡Œforâ€¦ofå¾ªç¯æ—¶ï¼Œä¼šè°ƒç”¨Symbol.iteratoræ–¹æ³•ï¼Œè¿”å›è¯¥å¯¹è±¡çš„é»˜è®¤éå†å™¨<br>è¯¦è§åç»­ç« èŠ‚</li><li><code>Symbol.toPrimitive</code></li><li><code>Symbol.toStringTag</code><br>æŒ‡å‘ä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨è¯¥å¯¹è±¡ä¸Šè°ƒç”¨<code>Object.prototype.toString()</code>æ—¶ï¼Œå¦‚æœè¯¥å±æ€§å­˜åœ¨ï¼Œåˆ™ä»–çš„è¿”å›å€¼ä¼šå‡ºç°åœ¨toStringæ–¹æ³•è¿”å›çš„å­—ç¬¦ä¸²ä¹‹ä¸­ï¼Œæ¯”å¦‚[Object Array]<br>æ–°å¢å†…ç½®å¯¹è±¡ä¸¾ä¸ªä¾‹å­ï¼š<code>JSON[Symbol.toStringTag]ï¼š&#39;JSON&#39;</code></li></ul><h2 id="lesson2-Setå’ŒMap"><a href="#lesson2-Setå’ŒMap" class="headerlink" title="lesson2 Setå’ŒMap"></a>lesson2 Setå’ŒMap</h2><h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><h4 id="åŸºæœ¬"><a href="#åŸºæœ¬" class="headerlink" title="åŸºæœ¬"></a>åŸºæœ¬</h4><ul><li><p>Setæ„é€ å‡½æ•°ç”Ÿæˆï¼Œæˆå‘˜å€¼å”¯ä¸€ï¼Œ(åˆ¤æ–­ä¸===åŒºåˆ«åœ¨äºNaN)ï¼Œä¸¤ä¸ªç©ºå¯¹è±¡è§†ä¸ºä¸åŒ</p></li><li><p>å®ä¾‹å±æ€§å’Œæ–¹æ³•</p><ul><li>å±æ€§ï¼š <code>Set.prototype.constructor</code>, <code>Set.prototype.size</code></li><li>æ–¹æ³•ï¼š <code>add(value)</code>, <code>delete(value)</code>, <code>has(value)</code>, <code>clear()</code><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.fromå¯ä»¥å°†<span class="built_in">Set</span>è½¬ä¸ºæ•°ç»„</span><br><span class="line"><span class="comment">// æ•°ç»„å»é‡</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dedupe</span>(<span class="params">array</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Array</span>.from(<span class="keyword">new</span> <span class="built_in">Set</span>(array));</span><br><span class="line">  <span class="comment">// return [...new Set(array)]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>éå†</p><ul><li>keys(), values(), entries(), forEach() æ–¹æ³•</li><li>éå†é¡ºåºä¸ºæ’å…¥é¡ºåºï¼Œæˆ–å¯ç”¨äºè®¾ç½®æŒ‡å®šé¡ºåºçš„å›è°ƒå‡½æ•°</li><li>Setçš„é”®åé”®å€¼ç›¸åŒ</li><li>Seté»˜è®¤å¯éå†ï¼Œé»˜è®¤éå†å™¨ç”Ÿæˆå‡½æ•°æ˜¯valuesæ–¹æ³•ï¼Œè¿™æ„å‘³ç€ï¼Œå¯ä»¥çœç•¥valuesæ–¹æ³•ï¼Œç›´æ¥ç”¨forâ€¦ofå¾ªç¯éå† Set<br><code>Set.prototype[Symbol.iterator] === Set.prototype.values</code></li><li><code>...</code>å†…éƒ¨ä½¿ç”¨<code>for ... of</code>ï¼Œæ•…å¯ä»¥ä½¿ç”¨<code>[...Set]</code>ï¼Œè½¬ä¸ºæ•°ç»„åå¯ä»¥æ–¹ä¾¿ä½¿ç”¨æ•°ç»„æ–¹æ³•å¦‚mapå’Œfilter</li></ul></li></ul><h4 id="WeakSet"><a href="#WeakSet" class="headerlink" title="WeakSet"></a>WeakSet</h4><ul><li>æˆå‘˜åªèƒ½ä¸ºå¯¹è±¡</li><li>å¼±å¼•ç”¨ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶å¯¹å¯¹è±¡å¼•ç”¨è®¡æ•°æ—¶ä¸è€ƒè™‘WeakSetä¸­å¯¹å¯¹è±¡çš„å¼•ç”¨</li><li><code>new WeakSet()</code> å¯ä»¥æ¥æ”¶ä»»ä½•å…·æœ‰ <code>Iterable</code> æ¥å£çš„å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œä½†å¿…é¡»æ³¨æ„åŠ å…¥<code>WeakSet</code>çš„æˆå‘˜å¿…é¡»ä¸ºå¯¹è±¡</li><li>WeakSetæœ‰ä»¥ä¸‹ä¸‰ä¸ªæ–¹æ³•ï¼š<code>add(value)</code>, <code>delete(value)</code>, <code>has(value)</code>ï¼Œæ²¡æœ‰sizeå±æ€§ï¼Œä¸å¯éå†ï¼ˆæ²¡æœ‰forEachå’Œclearæ–¹æ³•ï¼‰</li></ul><h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><h4 id="åŸºæœ¬-1"><a href="#åŸºæœ¬-1" class="headerlink" title="åŸºæœ¬"></a>åŸºæœ¬</h4><ul><li>é”®å€¼å¯¹çš„é›†åˆï¼ˆHashç»“æ„ï¼‰ï¼Œé”®å’Œå¯¹è±¡ä¸ä¸€æ ·ï¼Œä¸å±€é™äºå­—ç¬¦ä¸²ã€‚</li><li>ä»»ä½•å…·æœ‰ Iterator æ¥å£ã€ä¸”æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ä¸€ä¸ªåŒå…ƒç´ çš„æ•°ç»„çš„æ•°æ®ç»“æ„éƒ½å¯ä»¥ä½œä¸ºMapæ„é€ å‡½æ•°çš„å‚æ•°</li><li><p>åªæœ‰å¯¹åŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨æˆ–è€…ä¸¥æ ¼ç›¸ç­‰çš„ç®€å•ç±»å‹ï¼ˆåŒ…æ‹¬NaNï¼‰æ‰ä¼šç”Ÿæˆä¸€æ ·çš„Map</p></li><li><p>å®ä¾‹å±æ€§å’Œæ–¹æ³•</p><ul><li>å±æ€§ï¼š <code>Map.prototype.constructor</code>, <code>Map.prototype.size</code></li><li>æ–¹æ³•ï¼š <code>set()</code>, <code>get()</code>, <code>delete(value)</code>, <code>has(value)</code>, <code>clear()</code></li></ul></li><li><p>éå†</p><ul><li>ç±»ä¼¼ä¸Šè¿°Setçš„éå†</li><li>Map ç»“æ„çš„é»˜è®¤éå†å™¨æ¥å£ï¼ˆSymbol.iteratorå±æ€§ï¼‰ï¼Œå°±æ˜¯entriesæ–¹æ³•</li></ul></li></ul><h4 id="ä¸å…¶ä»–æ•°æ®ç»“æ„è½¬æ¢"><a href="#ä¸å…¶ä»–æ•°æ®ç»“æ„è½¬æ¢" class="headerlink" title="ä¸å…¶ä»–æ•°æ®ç»“æ„è½¬æ¢"></a>ä¸å…¶ä»–æ•°æ®ç»“æ„è½¬æ¢</h4><ul><li>æ•°ç»„ï¼Œå¯¹è±¡ï¼ŒJSONäº’è½¬<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">strMapToObj</span>(<span class="params">strMap</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> obj = <span class="built_in">Object</span>.create(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> [k,v] <span class="keyword">of</span> strMap) &#123;</span><br><span class="line">    obj[k] = v;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="WeakMap"><a href="#WeakMap" class="headerlink" title="WeakMap"></a>WeakMap</h4><ul><li>é”®ååªèƒ½ä¸ºå¯¹è±¡</li><li>WeakMapçš„é”®åæ‰€æŒ‡å‘çš„å¯¹è±¡ï¼Œä¸è®¡å…¥åƒåœ¾å›æ”¶æœºåˆ¶</li><li>WeakMapæœ‰ä»¥ä¸‹ä¸‰ä¸ªæ–¹æ³•ï¼š<code>get</code>, <code>set</code>, <code>delete(value)</code>, <code>has(value)</code>ï¼Œæ²¡æœ‰sizeå±æ€§ï¼Œä¸å¯éå†ï¼ˆæ²¡æœ‰forEachå’Œclearæ–¹æ³•ï¼‰</li></ul><p><img src="http://opo02jcsr.bkt.clouddn.com/a3ca4dc0aad89c377838dcf51642e109.jpg" alt=""></p><h2 id="lesson3-Proxy"><a href="#lesson3-Proxy" class="headerlink" title="lesson3 Proxy"></a>lesson3 Proxy</h2><h3 id="è§‚å¯Ÿ"><a href="#è§‚å¯Ÿ" class="headerlink" title="è§‚å¯Ÿ"></a>è§‚å¯Ÿ</h3><ul><li><p>ä¸¾ä¸ªæ —å­<br>å½“ä½ ä¸ºå¯¹è±¡aèµ‹å€¼a.b=cæ—¶ï¼Œä½ å¸Œæœ›åœ¨bå±æ€§èµ‹å€¼æ—¶æœ‰ä¸€ä¸ªèŒƒå›´å¤§å°çš„æ ¡éªŒï¼Œè¶…å‡ºèŒƒå›´æŠ›é”™ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯èƒ½ä¼šæƒ³åˆ°é‡è½½setæ–¹æ³•,æ¯”å¦‚ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;&#125;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(a, <span class="string">'b'</span>, &#123;</span><br><span class="line">  set(x) &#123;</span><br><span class="line">    <span class="keyword">if</span> (x&gt;<span class="number">100</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RangeError</span>(<span class="string">'invalid range'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.b = x</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>åŠ¨æ‰‹ä»¥åå‘ç°ä¸€ä¸ªé—®é¢˜â€¦è¿™æ ·ä¼šæ ˆæº¢å‡ºï¼Œå› ä¸ºåœ¨setå†…å†setäº†bçš„å€¼ï¼Œæ— é™å¾ªç¯â€¦å˜é€šä¸€ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;&#125;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(a, <span class="string">'b'</span>, &#123;</span><br><span class="line">  get(x) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.c</span><br><span class="line">  &#125;</span><br><span class="line">  set(x) &#123;</span><br><span class="line">    <span class="keyword">if</span> (x&gt;<span class="number">100</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RangeError</span>(<span class="string">'invalid range'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.c = x</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ç„¶è€Œæ€»è¦è¿™ä¹ˆå†™æ„Ÿè§‰å¾ˆéº»çƒ¦ï¼Œè€Œä¸”å¦‚æœæ˜¯å¯¹ä¸€ç±»å±æ€§è¿›è¡Œæ“ä½œæ—¶ï¼Œé‡å¤å†™å¾ˆæ²¡å¿…è¦ï¼Œæ¢ç”¨Proxyå†™æ³•ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> handler = &#123;</span><br><span class="line">  set(obj, prop, value, receiver) &#123;</span><br><span class="line">    <span class="keyword">if</span> (prop === <span class="string">'b'</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (value&gt;<span class="number">100</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RangeError</span>(<span class="string">'invalid range'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    obj[prop] = value</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(a, handler)</span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥ä¹Ÿèˆ’æœå¤šäº†ï¼Œè€Œä¸”å¯ä»¥æ ¹æ®å±æ€§ååœ¨setæ–¹æ³•å†…åšåˆ¤æ–­ï¼Œæ›´å¯æ‰©å±•</p></li></ul><h3 id="åº–ä¸è§£ç‰›"><a href="#åº–ä¸è§£ç‰›" class="headerlink" title="åº–ä¸è§£ç‰›"></a>åº–ä¸è§£ç‰›</h3><ul><li><p>ä»£ç†proxy</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> target = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> handler = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, handler);</span><br><span class="line"><span class="comment">// å°†ä»£ç†çš„æ‰€æœ‰å†…éƒ¨æ–¹æ³•è½¬å‘è‡³ç›®æ ‡</span></span><br><span class="line">proxy.a = <span class="number">1</span> =&gt; target.a = <span class="number">1</span>;</span><br><span class="line">target.b = <span class="number">4</span> =&gt; proxy.b = <span class="number">4</span>;</span><br><span class="line">target !== proxy</span><br><span class="line">target.__proto__ === proxy.__proto__</span><br><span class="line"><span class="comment">// åº”åœ¨ä»£ç†å¯¹è±¡ä¸Šæ“ä½œï¼Œä»£ç†æ‰èƒ½ç”Ÿæ•ˆ</span></span><br><span class="line">handler = &#123;get()&#123;<span class="keyword">return</span> <span class="number">12</span>&#125;&#125;</span><br><span class="line">target.v <span class="comment">// undefined</span></span><br><span class="line">proxy.v <span class="comment">// 12</span></span><br></pre></td></tr></table></figure></li><li><p>Proxyæ”¯æŒçš„æ‹¦æˆªæ“ä½œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">get(target, propKey, receiver) <span class="comment">// proxy.foo, proxy['foo']</span></span><br><span class="line">set(target, propKey, value, receiver) <span class="comment">//proxy.foo = v, proxy['foo'] = v</span></span><br><span class="line">has(target, propKey) <span class="comment">// propKey in proxy</span></span><br><span class="line">deleteProperty(target, propKey) <span class="comment">// delete proxy[propKey]</span></span><br><span class="line">ownKeys(target) <span class="comment">// Object.getOwnPropertyNames(proxy), Object.getOwnPropertySymbols(proxy), Object.keys(proxy)</span></span><br><span class="line">getOwnPropertyDescriptor(target, propKey) <span class="comment">// Object.getOwnPropertyDescriptor(proxy, propKey)</span></span><br><span class="line">defineProperty(target, propKey, propDesc) <span class="comment">// Object.defineProperty(proxy, propKey, propDesc), Object.defineProperties(proxy, propDescs)</span></span><br><span class="line">preventExtensions(target) <span class="comment">// Object.preventExtensions(proxy)</span></span><br><span class="line">getPrototypeOf(target) <span class="comment">// Object.getPrototypeOf(proxy)</span></span><br><span class="line">isExtensible(target) <span class="comment">// Object.isExtensible(proxy)</span></span><br><span class="line">setPrototypeOf(target, proto) <span class="comment">// Object.setPrototypeOf(proxy, proto)</span></span><br><span class="line">apply(target, object, args) <span class="comment">// æ‹¦æˆª Proxy å®ä¾‹ä½œä¸ºå‡½æ•°è°ƒç”¨çš„æ“ä½œï¼Œæ¯”å¦‚proxy(...args)ã€proxy.call(object, ...args)ã€proxy.apply(...)</span></span><br><span class="line">construct(target, args) <span class="comment">// new proxy(...args)</span></span><br></pre></td></tr></table></figure></li><li><p>ä»£ç†å¥æŸ„handler<br>å¥æŸ„å¯¹è±¡çš„æ–¹æ³•å¯ä»¥å¤å†™ä»£ç†çš„å†…éƒ¨æ–¹æ³•ï¼Œå…·ä½“ä¸ºä¸Šè¿°çš„14ç§ã€‚</p><ul><li><p>ä¸¾ä¸ªğŸŒ°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Tree</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Proxy</span>(&#123;&#125;, handler);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> handler = &#123;</span><br><span class="line">  get: <span class="function"><span class="keyword">function</span> (<span class="params">target, key, receiver</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!(key <span class="keyword">in</span> target)) &#123;</span><br><span class="line">      target[key] = Tree();  <span class="comment">// è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªå­æ ‘</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target, key, receiver);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> tree = <span class="keyword">new</span> Tree()</span><br><span class="line">tree.branch1.branch2.twig = <span class="string">"green"</span></span><br></pre></td></tr></table></figure></li><li><p>å†æ¥ä¸ªğŸŒ°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®ç°å¯¹inæ“ä½œç¬¦éšè—å±æ€§</span></span><br><span class="line"><span class="keyword">var</span> handler = &#123;</span><br><span class="line">  has (target, key) &#123;</span><br><span class="line">    <span class="keyword">if</span> (key[<span class="number">0</span>] === <span class="string">'_'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> key <span class="keyword">in</span> target;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> target = &#123; <span class="attr">_prop</span>: <span class="string">'foo'</span>, <span class="attr">prop</span>: <span class="string">'foo'</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, handler);</span><br><span class="line"><span class="string">'_prop'</span> <span class="keyword">in</span> proxy <span class="comment">// false</span></span><br></pre></td></tr></table></figure></li><li><p>ç‰¹åˆ«æ³¨æ„<br>å¦‚æœç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•æˆ–è€…ç›®æ ‡å¯¹è±¡çš„å±æ€§ä¸å¯å†™æˆ–è€…ä¸å¯é…ç½®æ—¶ï¼Œä»£ç†ä¸èƒ½ç”Ÿæ•ˆï¼Œå¯èƒ½ä¼šæŠ¥é”™<br>éœ€æ³¨æ„ä¸€äº›ç‰¹å®šçš„æ–¹æ³•å¯¹è¿”å›å€¼æœ‰è¦æ±‚ï¼Œä¸å¦‚é‡å†™isExtensibleæ–¹æ³•æ—¶ï¼Œè¿”å›å€¼ä¸ç›®æ ‡å¯¹è±¡çš„isExtensibleå±æ€§åº”ä¸€è‡´ï¼Œå¦åˆ™ä¼šæŠ¥é”™<br>åˆ©ç”¨ä»£ç†é‡å†™å¯ä»¥åšå¾ˆå¤šäº‹æƒ…æ¯”å¦‚éšè—å±æ€§ã€å¯¹æŸäº›å±æ€§ã€æ“ä½œç¬¦å±è”½ã€æ‹¦æˆªå†…åœ¨æ–¹æ³•å¹¶ä¸”åŠ ä¸Šè‡ªå·±æƒ³è¦çš„é€»è¾‘å¤„ç†å»å¾—åˆ°é¢„æœŸç»“æœç­‰</p></li></ul></li></ul><h3 id="é¥­åç”œç‚¹"><a href="#é¥­åç”œç‚¹" class="headerlink" title="é¥­åç”œç‚¹"></a>é¥­åç”œç‚¹</h3><ul><li><p>Proxy.revocable<br>è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œproxyå±æ€§å¯¹åº”Proxyå®ä¾‹ï¼Œrevokeå±æ€§ä¸ºrevokeæ–¹æ³•å¯ä»¥å–æ¶ˆProxyå®ä¾‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123;proxy, revoke&#125; = <span class="built_in">Proxy</span>.revocable(target, handler);</span><br><span class="line">proxy.foo = <span class="number">1</span></span><br><span class="line">revoke()</span><br><span class="line">proxy.foo <span class="comment">// TypeError: Revoked</span></span><br></pre></td></tr></table></figure></li><li><p>thisé—®é¢˜</p><ul><li>ä»£ç†ä»¥åç›®æ ‡å¯¹è±¡å†…éƒ¨çš„thisæŒ‡å‘çš„æ˜¯Proxyå®ä¾‹è€Œä¸æ˜¯ç›®æ ‡å¯¹è±¡</li><li><p>æœ‰æ—¶å€™å¯èƒ½å› ä¸ºthisæŒ‡å‘é—®é¢˜å¯¼è‡´ä»£ç†è¾¾ä¸åˆ°é¢„æœŸæ•ˆæœ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// janeçš„nameå±æ€§å®é™…å­˜å‚¨åœ¨å¤–éƒ¨çš„WeakMapå¯¹è±¡çš„_nameä¸Šï¼Œå¯¼è‡´åç»­å–ä¸åˆ°å€¼</span></span><br><span class="line"><span class="keyword">const</span> _name = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">    _name.set(<span class="keyword">this</span>, name);</span><br><span class="line">  &#125;</span><br><span class="line">  get name() &#123;</span><br><span class="line">    <span class="keyword">return</span> _name.get(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> jane = <span class="keyword">new</span> Person(<span class="string">'Jane'</span>);</span><br><span class="line">jane.name <span class="comment">// 'Jane'</span></span><br><span class="line"><span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(jane, &#123;&#125;);</span><br><span class="line">proxy.name <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure></li><li><p>æŸäº›åŸç”Ÿå¯¹è±¡çš„éƒ¨åˆ†å±æ€§éœ€è¦thisæŒ‡å‘åŸç”Ÿå¯¹è±¡æ—¶æ‰èƒ½è·å–ï¼Œå¦‚Date.getDate()ï¼Œæ­¤æ—¶proxy getæ—¶éœ€è¦æ³¨æ„thisç»‘å®šåŸå§‹å¯¹è±¡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> target = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2015-01-01'</span>);</span><br><span class="line"><span class="keyword">const</span> handler = &#123;</span><br><span class="line">  get(target, prop) &#123;</span><br><span class="line">    <span class="keyword">if</span> (prop === <span class="string">'getDate'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> target.getDate.bind(target);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target, prop);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, handler);</span><br><span class="line">proxy.getDate() <span class="comment">// 1</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="è¿›é˜¶"><a href="#è¿›é˜¶" class="headerlink" title="è¿›é˜¶"></a>è¿›é˜¶</h3><ul><li>TO BE CONTINUED!</li></ul><h2 id="lesson4-Reflect"><a href="#lesson4-Reflect" class="headerlink" title="lesson4 Reflect"></a>lesson4 Reflect</h2><h3 id="åˆè¯†"><a href="#åˆè¯†" class="headerlink" title="åˆè¯†"></a>åˆè¯†</h3><ul><li>Reflectå¯¹è±¡ä¸Proxyå¯¹è±¡ä¸€æ ·ï¼Œæ˜¯ä¸ºäº†æ“ä½œå¯¹è±¡è€Œæä¾›çš„æ–°APIï¼Œå­˜åœ¨çš„åŸå› å¦‚ä¸‹ï¼š<ul><li>å°†Objectå¯¹è±¡çš„ä¸€äº›å†…éƒ¨æ–¹æ³•æ·»åŠ åˆ°Reflectå¯¹è±¡ä¸Šï¼Œä¸”ä»¥åçš„æ–°æ–¹æ³•éƒ½éƒ¨ç½²åˆ°Reflectå¯¹è±¡ä¸Šï¼Œå®Œæˆåˆ†ç¦»</li><li>è®©å¯¹è±¡æ“ä½œå˜æˆå‡½æ•°è¡Œä¸º</li><li>ä¿®æ”¹Objectå¯¹è±¡ä¸€äº›å†…éƒ¨æ–¹æ³•åœ¨å‡ºé”™æ—¶çš„è¿”å›</li><li>Proxyè¦†å†™å¯¹è±¡æ–¹æ³•æ—¶ï¼Œæä¾›ä¸€ä¸ªReflectå¯¹è±¡ç”¨æ¥è·å–åŸå§‹æ–¹æ³•ï¼Œä»¥è®¾ç½®é»˜è®¤å€¼ï¼Œå†æ­¤åŸºç¡€ä¸Šå†åšåŠŸèƒ½æ·»åŠ å’Œä¿®æ”¹</li></ul></li></ul><h3 id="æ­é¢"><a href="#æ­é¢" class="headerlink" title="æ­é¢"></a>æ­é¢</h3><ul><li><p>é™æ€æ–¹æ³•<br>å¯¹åº”äºProxyå¯è¦†å†™çš„æ–¹æ³•ï¼Œæœ‰13ä¸ªé™æ€æ–¹æ³•</p></li><li><p>æ³¨æ„</p><ul><li><p>Proxyå’ŒReflectè”ç”¨çš„æ—¶å€™è¦å°å¿ƒï¼Œå¯èƒ½ä¸€ä¸ªæ‹¦æˆªä¼šè§¦å‘å¦ä¸€ä¸ªæ‹¦æˆª</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p = &#123;</span><br><span class="line">  a: <span class="string">'a'</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> handler = &#123;</span><br><span class="line">  set(target, key, value, receiver) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'set'</span>);</span><br><span class="line">    <span class="built_in">Reflect</span>.set(target, key, value, receiver)</span><br><span class="line">  &#125;,</span><br><span class="line">  defineProperty(target, key, attribute) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'defineProperty'</span>);</span><br><span class="line">    <span class="built_in">Reflect</span>.defineProperty(target, key, attribute);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> obj = <span class="keyword">new</span> <span class="built_in">Proxy</span>(p, handler);</span><br><span class="line">obj.a = <span class="string">'A'</span>;</span><br><span class="line"><span class="comment">// set</span></span><br><span class="line"><span class="comment">// defineProperty</span></span><br></pre></td></tr></table></figure><p>åœ¨Reflect.setä¼ å…¥receiverçš„æ—¶å€™è§¦å‘äº†Proxy.definePropertyï¼Œä¸ä¼ å…¥receiveræ—¶ä¸ä¼šè§¦å‘definePropertyæ‹¦æˆª</p></li><li><p>å¯¹äºå‚æ•°çš„è¦æ±‚ã€è½¬æ¢å’ŒæŠ¥é”™å¤„ç†</p></li></ul></li></ul><h3 id="ğŸŒ°"><a href="#ğŸŒ°" class="headerlink" title="ğŸŒ°"></a>ğŸŒ°</h3><ul><li>ä½¿ç”¨Proxyå®ç°è§‚å¯Ÿè€…æ¨¡å¼<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> person = observable(&#123;</span><br><span class="line">  name: <span class="string">'å¼ ä¸‰'</span>,</span><br><span class="line">  age: <span class="number">20</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;person.name&#125;</span>, <span class="subst">$&#123;person.age&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br><span class="line">observe(print);</span><br><span class="line">person.name = <span class="string">'æå››'</span>;</span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line"><span class="comment">// æå››, 20</span></span><br><span class="line"><span class="comment">/**************************/</span></span><br><span class="line"><span class="keyword">const</span> queuedObservers = <span class="keyword">new</span> <span class="built_in">Set</span>();</span><br><span class="line"><span class="keyword">const</span> observe = <span class="function"><span class="params">fn</span> =&gt;</span> queuedObservers.add(fn);</span><br><span class="line"><span class="keyword">const</span> observable = <span class="function"><span class="params">obj</span> =&gt;</span> <span class="keyword">new</span> <span class="built_in">Proxy</span>(obj, &#123;set&#125;);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params">target, key, value, receiver</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="built_in">Reflect</span>.set(target, key, value, receiver);</span><br><span class="line">  queuedObservers.forEach(<span class="function"><span class="params">observer</span> =&gt;</span> observer());</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="lesson5-éå†å™¨Iterator"><a href="#lesson5-éå†å™¨Iterator" class="headerlink" title="lesson5 éå†å™¨Iterator"></a>lesson5 éå†å™¨Iterator</h2><h3 id="é‡è§"><a href="#é‡è§" class="headerlink" title="é‡è§"></a>é‡è§</h3><ul><li><p>why Iterator<br>jsä¸­æ•°æ®é›†åˆçš„æ¦‚å¿µè¶Šæ¥è¶Šå¤šï¼Œå¦‚æœèƒ½æœ‰ä¸€ç§ç»Ÿä¸€çš„è®¿é—®æ–¹å¼å°†æ˜¯æå¥½çš„ã€‚Iteratorçš„è®¾è®¡å°±åŸºäºæ­¤ï¼Œé€šè¿‡ä¸ºç›¸åº”æ•°æ®ç»“æ„éƒ¨ç½²iteratoræ¥å£è®©è¯¥æ•°æ®ç»“æ„å¯é€šè¿‡ç»Ÿä¸€çš„æ–¹å¼:forâ€¦oféå†</p></li><li><p>éå†è¿‡ç¨‹ï¼š</p><ul><li>åˆ›å»ºä¸€ä¸ªæŒ‡é’ˆå¯¹è±¡æŒ‡å‘å½“å‰æ•°æ®ç»“æ„çš„åˆå§‹ä½ç½®ï¼ˆéå†å™¨å¯¹è±¡å®é™…ä¸ºä¸€ä¸ªæŒ‡é’ˆå¯¹è±¡ï¼‰</li><li>è°ƒç”¨æŒ‡é’ˆå¯¹è±¡çš„nextæ–¹æ³•ï¼Œç›´åˆ°æŒ‡å‘æ•°æ®ç»“æ„çš„ç»“æŸä½ç½®<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éå†å™¨ç”Ÿæˆå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeIterator</span>(<span class="params">array</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> nextIndex = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    next: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> nextIndex &lt; array.length ?</span><br><span class="line">        &#123;<span class="attr">value</span>: array[nextIndex++]&#125; :</span><br><span class="line">        &#123;<span class="attr">done</span>: <span class="literal">true</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>ä¸€ç§æ•°æ®ç»“æ„ï¼Œåªè¦éƒ¨ç½²äº†Iteratoræ¥å£ï¼Œå°±è§†ä¸ºå¯éå†çš„</p></li></ul><h3 id="ç›¸è¯†"><a href="#ç›¸è¯†" class="headerlink" title="ç›¸è¯†"></a>ç›¸è¯†</h3><h4 id="é»˜è®¤Iteratoræ¥å£"><a href="#é»˜è®¤Iteratoræ¥å£" class="headerlink" title="é»˜è®¤Iteratoræ¥å£"></a>é»˜è®¤Iteratoræ¥å£</h4><ul><li>é»˜è®¤çš„Iteratoræ¥å£éƒ¨ç½²åœ¨[Symbol.iterator]å±æ€§ä¸Šï¼Œ<code>Symbol.iterator</code>å±æ€§é”®ä¸ºSymbolå¯¹è±¡ï¼Œå€¼ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œå³éå†å™¨ç”Ÿæˆå‡½æ•°ï¼Œæ‰§è¡Œè¯¥å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å…·æœ‰ä¸€ä¸ªnextæ–¹æ³•ï¼Œè°ƒç”¨è¯¥æ–¹æ³•å¯ä»¥è¿”å›{value, done}å¯¹è±¡ï¼Œä»£è¡¨äº†å½“å‰æˆå‘˜çš„ä¿¡æ¯</li><li>éƒ¨åˆ†æ•°æ®ç»“æ„å¦‚Arrayã€Setã€Mapã€Stringç­‰å·²ç»éƒ¨ç½²äº†Iteratoræ¥å£ï¼Œå¯¹è±¡åˆ™éœ€è¦æ‰‹åŠ¨æ·»åŠ è¿™æ ·çš„æ–¹æ³•å®ç°Iteratoræ¥å£</li><li>å¯¹äºéçº¿æ€§æ•°æ®ç»“æ„ï¼ŒIteratoræ¥å£å®é™…ä¸Šå°±æ˜¯ä¸€ç§çº¿æ€§è½¬æ¢ï¼Œä¸‹ä¾‹ä¸ºclasså®ç°éå†å™¨<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RangeIterator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(start, stop) &#123;</span><br><span class="line">    <span class="keyword">this</span>.value = start;</span><br><span class="line">    <span class="keyword">this</span>.stop = stop;</span><br><span class="line">  &#125;</span><br><span class="line">  [<span class="built_in">Symbol</span>.iterator]() &#123; <span class="keyword">return</span> <span class="keyword">this</span>; &#125;</span><br><span class="line">  next() &#123;</span><br><span class="line">    <span class="keyword">var</span> value = <span class="keyword">this</span>.value;</span><br><span class="line">    <span class="keyword">if</span> (value &lt; <span class="keyword">this</span>.stop) &#123;</span><br><span class="line">      <span class="keyword">this</span>.value++;</span><br><span class="line">      <span class="keyword">return</span> &#123;<span class="attr">done</span>: <span class="literal">false</span>, <span class="attr">value</span>: value&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="attr">done</span>: <span class="literal">true</span>, <span class="attr">value</span>: <span class="literal">undefined</span>&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">range</span>(<span class="params">start, stop</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> RangeIterator(start, stop);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> value <span class="keyword">of</span> range(<span class="number">0</span>, <span class="number">3</span>)) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value); <span class="comment">// 0, 1, 2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="ä¸¾ä¸ªğŸŒ°"><a href="#ä¸¾ä¸ªğŸŒ°" class="headerlink" title="ä¸¾ä¸ªğŸŒ°"></a>ä¸¾ä¸ªğŸŒ°</h4><ul><li><p>å®ç°æŒ‡é’ˆ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Node</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.value = value;</span><br><span class="line">  <span class="keyword">this</span>.next = <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// for...ofæ—¶ä¼šè°ƒç”¨æ”¹éå†å™¨ç”Ÿæˆå‡½æ•°</span></span><br><span class="line">Node.prototype[<span class="built_in">Symbol</span>.iterator]= <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è¿”å›çš„éå†å™¨å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">var</span> iterator = &#123;</span><br><span class="line">    next: next</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å½“å‰æˆå‘˜</span></span><br><span class="line">  <span class="keyword">var</span> current = <span class="keyword">this</span></span><br><span class="line">  next() &#123;</span><br><span class="line">    <span class="keyword">if</span>(current) &#123;</span><br><span class="line">      <span class="keyword">var</span> value = current.value;</span><br><span class="line">      <span class="comment">// ç§»åŠ¨æŒ‡é’ˆ</span></span><br><span class="line">      current = current.next;</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">done</span>: <span class="literal">false</span>, <span class="attr">value</span>: value &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">done</span>: <span class="literal">true</span>, <span class="attr">value</span>: <span class="literal">undefined</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> iterator</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ–°å»ºå¯¹è±¡ï¼Œå› ä¸ºåœ¨åŸå‹ä¸Šå®ç°çš„éå†å™¨ç”Ÿæˆå‡½æ•°ï¼Œæ‰€ä»¥æ¯ä¸ªå®ä¾‹éƒ½å®ç°äº†éå†å™¨æ¥å£</span></span><br><span class="line"><span class="keyword">var</span> one = <span class="keyword">new</span> Node(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">var</span> two = <span class="keyword">new</span> Node(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">var</span> three = <span class="keyword">new</span> Node(<span class="number">3</span>);</span><br><span class="line"><span class="comment">// å½“å‰æˆå‘˜çš„nextæŒ‡å‘ä¸‹ä¸€ä¸ªæˆå‘˜ï¼Œåœ¨nextæ–¹æ³•ä¸­å®ç°æŒ‡é’ˆç§»åŠ¨</span></span><br><span class="line">one.next = two;</span><br><span class="line">two.next = three;</span><br><span class="line"><span class="comment">// å¯¹å¯¹è±¡ä½¿ç”¨for...ofæ—¶ï¼Œå»æŸ¥æ‰¾[Symbol.iterator]å±æ€§ï¼Œæ‰¾åˆ°åå¾ªç¯è°ƒç”¨nextæ–¹æ³•ï¼Œç›´åˆ°è¿”å›å€¼å¾—doneå±æ€§ä¸ºtrue</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">of</span> one)&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i); <span class="comment">// 1, 2, 3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœ<code>Symbol.iterator</code>æ–¹æ³•å¯¹åº”çš„ä¸æ˜¯éå†å™¨ç”Ÿæˆå‡½æ•°ï¼Œåˆ™ä¼šæŠ¥é”™</p></li></ul><h3 id="åœ¨ä½•æ–¹"><a href="#åœ¨ä½•æ–¹" class="headerlink" title="åœ¨ä½•æ–¹"></a>åœ¨ä½•æ–¹</h3><h4 id="è°ƒç”¨åœºåˆ"><a href="#è°ƒç”¨åœºåˆ" class="headerlink" title="è°ƒç”¨åœºåˆ"></a>è°ƒç”¨åœºåˆ</h4><ul><li>è§£æ„èµ‹å€¼</li><li><p>æ‰©å±•è¿ç®—ç¬¦<br>ä»»ä½•å®ç°äº†Iteratoræ¥å£ï¼ˆå¯éå†ï¼‰çš„æ•°æ®ç»“æ„éƒ½å¯ä»¥é€šè¿‡<code>...</code>å°†å…¶è½¬åŒ–ä¸ºæ•°ç»„</p></li><li><p><code>yield*</code>åè·Ÿä¸€ä¸ªå¯éå†æ•°æ®ç»“æ„æ—¶ï¼Œä¼šè°ƒç”¨è¯¥ç»“æ„çš„éå†å™¨æ¥å£</p></li><li><code>for...of</code>, <code>Array.from</code>, <code>Map</code>, <code>Set</code>, <code>Promise.all()</code>, <code>Promise.race()</code></li></ul><h4 id="å­—ç¬¦ä¸²ã€æ•°ç»„ç­‰çš„éå†å™¨"><a href="#å­—ç¬¦ä¸²ã€æ•°ç»„ç­‰çš„éå†å™¨" class="headerlink" title="å­—ç¬¦ä¸²ã€æ•°ç»„ç­‰çš„éå†å™¨"></a>å­—ç¬¦ä¸²ã€æ•°ç»„ç­‰çš„éå†å™¨</h4><ul><li><p>å­—ç¬¦ä¸²<br>forâ€¦ofèƒ½å¤Ÿæ­£ç¡®è¯†åˆ«32ä½UTF-16å­—ç¬¦</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> someString = <span class="string">"hi"</span>;</span><br><span class="line"><span class="keyword">typeof</span> someString[<span class="built_in">Symbol</span>.iterator]</span><br><span class="line"><span class="comment">// "function"</span></span><br><span class="line"><span class="keyword">var</span> iterator = someString[<span class="built_in">Symbol</span>.iterator]();</span><br><span class="line"><span class="comment">// å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¿®æ”¹Symbol.iteratoræ–¹æ³•è¾¾åˆ°ä½ æƒ³è¦çš„éå†ç»“æœ</span></span><br><span class="line">iterator.next()  <span class="comment">// &#123; value: "h", done: false &#125;</span></span><br><span class="line">iterator.next()  <span class="comment">// &#123; value: "i", done: false &#125;</span></span><br><span class="line">iterator.next()  <span class="comment">// &#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure></li><li><p>return, throwæ–¹æ³•<br>è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯åœ¨è®¾ç½®éå†å™¨ç”Ÿæˆå‡½æ•°æ—¶å¯é€‰çš„ï¼Œä¸€èˆ¬é…åˆgeneratorä½¿ç”¨ï¼Œæ‰€ä»¥ä¸‹æ¬¡å†è¯´</p></li><li><p>æ•°ç»„</p><ul><li>for â€¦ of åªè¿”å›å…·æœ‰æ•°å­—ç´¢å¼•çš„é”®å€¼çš„å€¼</li><li>ç±»æ•°ç»„å¯¹è±¡å¯ä»¥ä½¿ç”¨æ•°ç»„çš„é»˜è®¤éå†ç”Ÿæˆå™¨è¾¾åˆ°éå†æ•ˆæœï¼ˆè¦æ±‚æ˜¯æ•°å­—ç´¢å¼•ä»¥åŠå…·æœ‰lengthå±æ€§ï¼‰</li></ul></li><li><p>Map, Set</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Mapéå†è¿”å›çš„æ˜¯æ•°ç»„[k, v]ï¼ŒSetè¿”å›çš„æ˜¯å€¼</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [key, value] <span class="keyword">of</span> map) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(key + <span class="string">' : '</span> + value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç±»æ•°ç»„å¯¹è±¡<br>åˆ©ç”¨Array.fromå°†å…¶è½¬åŒ–ä¸ºæ•°ç»„ï¼Œå†ä½¿ç”¨æ•°ç»„çš„éå†å™¨æ¥å£ç”¨forâ€¦ofå®ç°éå†</p></li></ul><h4 id="for-â€¦-of-æ³¨æ„"><a href="#for-â€¦-of-æ³¨æ„" class="headerlink" title="for â€¦ of æ³¨æ„"></a>for â€¦ of æ³¨æ„</h4><ul><li>å¯ä»¥ç»“åˆbreakã€continueã€returnä½¿ç”¨</li><li>æä¾›äº†å¤šç§æ•°æ®ç»“æ„çš„ç»Ÿä¸€è®¿é—®æ–¹å¼</li><li>ç›¸æ¯”for â€¦ inï¼Œåè€…éå†çš„æ˜¯é”®ï¼Œä¸”é”®åä¸ºå­—ç¬¦ä¸²ï¼Œè¿˜å¯èƒ½ä¼šéå†åŸå‹ä¸Šçš„é”®</li></ul></div></div><div class="article-footer"><div class="article-meta pull-left"><span class="post-categories"><i class="icon-categories"></i> <a href="/categories/code/">code</a> </span><span class="post-tags"><i class="icon-tags"></i> <a href="/tags/js/">js</a></span></div></div></article></main><footer class="site-footer"><p class="site-info">Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a><br>&copy; 2018 Derek Zhou</p></footer></div></div></body></html>